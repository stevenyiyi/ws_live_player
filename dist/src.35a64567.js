parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"D9Nj":[function(require,module,exports) {

},{}],"xVgw":[function(require,module,exports) {
"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t,r){return(t=i(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,i(o.key),o)}}function n(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function i(t){var r=l(t,"string");return"symbol"===e(r)?r:String(r)}function l(t,r){if("object"!==e(t)||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var n=o.call(t,r||"default");if("object"!==e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Logger=exports.LogLevel=exports.Log=void 0,exports.getTagged=g,exports.setDefaultLogLevel=c;var u=exports.LogLevel={Error:0,Warn:1,Log:2,Debug:3},a=u.Debug;function c(e){a=e}var f=exports.Logger=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a,o=arguments.length>1?arguments[1]:void 0;r(this,e),this.tag=o,this.setLevel(t)}return n(e,[{key:"setLevel",value:function(e){this.level=e}},{key:"_log",value:function(t,r){r=Array.prototype.slice.call(r),this.tag&&r.unshift("[".concat(this.tag,"]")),this.level>=t&&console[e.level_map[t]].apply(console,r)}},{key:"log",value:function(){this._log(u.Log,arguments)}},{key:"debug",value:function(){this._log(u.Debug,arguments)}},{key:"error",value:function(){this._log(u.Error,arguments)}},{key:"warn",value:function(){this._log(u.Warn,arguments)}}],[{key:"level_map",get:function(){return t(t(t(t({},u.Debug,"log"),u.Log,"log"),u.Warn,"warn"),u.Error,"error")}}]),e}(),s=new Map;function g(e){return s.has(e)||s.set(e,new f(a,e)),s.get(e)}var v=exports.Log=new f;
},{}],"dX8P":[function(require,module,exports) {
"use strict";function e(e,r){for(var t in r)r.hasOwnProperty(t)&&(e[t]=r[t])}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var r=exports.default=e;
},{}],"yB1D":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ASMediaError=void 0;var e=t(require("./extend.js"));function t(e){return e&&e.__esModule?e:{default:e}}function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,u(n.key),n)}}function i(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function u(e){var t=f(e,"string");return"symbol"===r(t)?t:String(t)}function f(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!==r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var E={MEDIA_ERR_ABORTED:1,MEDIA_ERR_NETWORK:2,MEDIA_ERR_RTSP:3,MEDIA_ERR_AV:4,MEDIA_ERR_DECODE:5,MEDIA_ERR_SRC_NOT_SUPPORTED:6},c=exports.ASMediaError=function(){function e(t,r){n(this,e),this.code=t,this.message=r}return i(e,null,[{key:"MEDIA_ERR_ABORTED",get:function(){return 1}},{key:"MEDIA_ERR_NETWORK",get:function(){return 2}},{key:"MEDIA_ERR_RTSP",get:function(){return 3}},{key:"MEDIA_ERR_AV",get:function(){return 4}},{key:"MEDIA_ERR_DECODE",get:function(){return 5}}]),e}();
},{"./extend.js":"dX8P"}],"Dnsu":[function(require,module,exports) {
"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=n(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,s=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){a=!0,u=e},f:function(){try{s||null==r.return||r.return()}finally{if(a)throw u}}}}function n(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function u(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(t){var n=a(t,"string");return"symbol"===e(n)?n:String(n)}function a(t,n){if("object"!==e(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,n||"default");if("object"!==e(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.TinyEvents=exports.EventSourceWrapper=exports.EventEmitter=exports.DestructibleEventListener=void 0;var l=Symbol("event_listener"),c=Symbol("event_listeners"),f=exports.DestructibleEventListener=function(){function e(t){i(this,e),this[l]=t,this[c]=new Map}return u(e,[{key:"clear",value:function(){if(this[c]){var e,n=t(this[c]);try{for(n.s();!(e=n.n()).done;){var r,i=e.value,o=t(i[1]);try{for(o.s();!(r=o.n()).done;){var u=r.value;this[l].removeEventListener(i[0],u)}}catch(s){o.e(s)}finally{o.f()}}}catch(s){n.e(s)}finally{n.f()}}this[c].clear()}},{key:"destroy",value:function(){this.clear(),this[c]=null}},{key:"on",value:function(e,t,n){return void 0===n&&(n=t,t=null),t?this.addEventListener(e,function(e){e.target.matches(t)&&n(e)}):this.addEventListener(e,n)}},{key:"addEventListener",value:function(e,t){return this[c].has(e)||this[c].set(e,new Set),this[c].get(e).add(t),this[l].addEventListener(e,t,!1),t}},{key:"removeEventListener",value:function(e,t){if(this[l].removeEventListener(e,t,!1),this[c].has(e)){var n=this[c].get(e);n.delete(t),n.size||this[c].delete(e)}}},{key:"dispatchEvent",value:function(e){this[l]&&this[l].dispatchEvent(e)}}]),e}(),v=exports.EventEmitter=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;i(this,e),this[l]=new f(t||document.createElement("div"))}return u(e,[{key:"clear",value:function(){this[l]&&this[l].clear()}},{key:"destroy",value:function(){this[l]&&(this[l].destroy(),this[l]=null)}},{key:"on",value:function(e,t,n){return this[l]?this[l].on(e,t,n):null}},{key:"addEventListener",value:function(e,t){return this[l]?this[l].addEventListener(e,t,!1):null}},{key:"removeEventListener",value:function(e,t){this[l]&&this[l].removeEventListener(e,t,!1)}},{key:"dispatchEvent",value:function(e,t){this[l]&&this[l].dispatchEvent(new CustomEvent(e,{detail:t}))}}]),e}(),h=exports.EventSourceWrapper=function(){function e(t){i(this,e),this.eventSource=t,this[c]=new Map}return u(e,[{key:"on",value:function(e,t,n){this[c].has(e)||this[c].set(e,new Set);var r=this.eventSource.on(e,t,n);r&&this[c].get(e).add(r)}},{key:"off",value:function(e,t){this.eventSource.removeEventListener(e,t)}},{key:"clear",value:function(){this.eventSource.clear(),this[c].clear()}},{key:"destroy",value:function(){this.eventSource.clear(),this[c]=null,this.eventSource=null}}]),e}(),y=exports.TinyEvents=function(){function e(){i(this,e),this._e={}}return u(e,[{key:"on",value:function(e,t){(this._e[e]||(this._e[e]=[])).push(t)}},{key:"off",value:function(e,t){var n=this._e[e]||[],r=n.indexOf(t);t>=0&&n.splice(r,1)}},{key:"emit",value:function(e,t){(this._e[e]||[]).slice().forEach(function(e){return e(t)})}}]),e}();
},{}],"jeF6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("./utils/event.js");function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,i(o.key),o)}}function n(t,e,r){return e&&o(t.prototype,e),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function i(t){var r=a(t,"string");return"symbol"===e(r)?r:String(r)}function a(t,r){if("object"!==e(t)||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var n=o.call(t,r||"default");if("object"!==e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}var u=exports.default=function(){function e(o){r(this,e),this.eventSource=new t.EventEmitter,this.cacheSize=o.cacheSize||500,this.flushInterval=o.flush||100,this.wsurl=o.wsurl,this.rtspurl=o.rtspurl,this.video=o.video,this.bufferedDuration=o.bufferedDuration||120,Object.defineProperties(this,{duration:{value:NaN,writable:!0},hasAudio:{get:function(){return this._getHasAudio()}},hasVideo:{get:function(){return this._getHasVideo()}},buffering:{value:!1,writable:!0},seeking:{value:!1,writable:!0},seekable:{value:!1,writable:!0},eof:{value:!1,writable:!0},audioInfo:{get:function(){return this._getAudioInfo()}},videoInfo:{get:function(){return this._getVideoInfo()}}})}return n(e,[{key:"load",value:function(){throw Error("Call load in abstract class!")}},{key:"seek",value:function(t){throw Error("Call seek in abstract class!")}},{key:"stop",value:function(){throw Error("Call stop in abstract class!")}},{key:"destroy",value:function(){throw Error("Call destroy in abstract class!")}},{key:"getBufferedRanges",value:function(){throw Error("Call etBufferedRanges in abstract class!")}},{key:"abort",value:function(){throw Error("Call abort in abstract class!")}},{key:"startStreamFlush",value:function(){var t=this;this.flushTimerId=setInterval(function(){t.paused||t.eventSource.dispatchEvent("flush")},this.flushInterval)}},{key:"stopStreamFlush",value:function(){clearInterval(this.flushTimerId)}},{key:"_getHasAudio",value:function(){throw Error("Call _getHasAudio() in abstract class!")}},{key:"_getHasVideo",value:function(){throw Error("Call _getHasVideo() in abstract class!")}},{key:"_getAudioInfo",value:function(){throw Error("Call _getAudioInfo() in abstract class!")}},{key:"_getVideoInfo",value:function(){throw Error("Call _getVideoInfo() in abstract class!")}}]),e}();
},{"./utils/event.js":"Dnsu"}],"XyKO":[function(require,module,exports) {
"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t,n){return(t=o(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}function u(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(t){var n=i(t,"string");return"symbol"===e(n)?n:String(n)}function i(t,n){if("object"!==e(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var u=r.call(t,n||"default");if("object"!==e(u))return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.StreamType=exports.PayloadType=exports.PESType=void 0;var c=exports.StreamType=function(){function e(){n(this,e)}return u(e,null,[{key:"VIDEO",get:function(){return 1}},{key:"AUDIO",get:function(){return 2}},{key:"CONTAINER",get:function(){return 3}},{key:"map",get:function(){return t(t(t({},e.VIDEO,"video"),e.AUDIO,"audio"),e.CONTAINER,"container")}}]),e}(),f=exports.PESType=function(){function e(){n(this,e)}return u(e,null,[{key:"AAC",get:function(){return 15}},{key:"ID3",get:function(){return 21}},{key:"PCMA",get:function(){return 144}},{key:"PCMU",get:function(){return 145}},{key:"G722",get:function(){return 146}},{key:"G723",get:function(){return 147}},{key:"G726",get:function(){return 148}},{key:"G729",get:function(){return 153}},{key:"H264",get:function(){return 27}},{key:"H265",get:function(){return 36}}]),e}(),y=exports.PayloadType=function(){function e(){n(this,e)}return u(e,null,[{key:"H264",get:function(){return 1}},{key:"H265",get:function(){return 2}},{key:"AV1",get:function(){return 3}},{key:"VP9",get:function(){return 4}},{key:"AAC",get:function(){return 5}},{key:"ALAW",get:function(){return 6}},{key:"ULAW",get:function(){return 7}},{key:"OPUS",get:function(){return 8}},{key:"G722",get:function(){return 9}},{key:"G723",get:function(){return 10}},{key:"G726",get:function(){return 11}},{key:"G729",get:function(){return 12}},{key:"TS",get:function(){return 13}},{key:"PS",get:function(){return 14}},{key:"map",get:function(){var n;return t(t(t(t(t(t(t(t(t(t(n={},e.H264,"video"),e.H265,"video"),e.AV1,"video"),e.VP9,"video"),e.AAC,"audio"),e.ALAW,"audio"),e.ULAW,"audio"),e.OPUS,"audio"),e.G722,"audio"),e.G723,"audio"),t(t(t(t(n,e.G726,"audio"),e.G729,"audio"),e.TS,"container"),e.PS,"container")}},{key:"string_map",get:function(){return{H264:e.H264,H265:e.H265,AV1:e.AV1,VP9:e.VP9,AAC:e.AAC,"MP4A-LATM":e.AAC,"MPEG4-GENERIC":e.AAC,PCMA:e.ALAW,PCMU:e.ULAW,opus:e.OPUS,G722:e.G722,G723:e.G723,G726:e.G726,G729:e.G729,M2TS:e.TS,MP2T:e.TS,PS:e.PS}}},{key:"stringCodec",value:function(e){return["unknown","h264","h265","av1","vp9","aac","alaw","ulaw","opus","g722","g723","g726","g729","ts","ps"][e]}}]),e}();
},{}],"xgs9":[function(require,module,exports) {
"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,o(r.key),r)}}function r(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function o(e){var n=a(e,"string");return"symbol"===t(n)?n:String(n)}function a(e,n){if("object"!==t(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,n||"default");if("object"!==t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.MP4=void 0;var s=exports.MP4=function(){function t(){e(this,t)}return r(t,null,[{key:"init",value:function(){var e,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(e in t.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],hvc1:[],hvcC:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},t.types)t.types.hasOwnProperty(e)&&(t.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),o=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);t.HDLR_TYPES={video:r,audio:o};var a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);t.STTS=t.STSC=t.STCO=s,t.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),t.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),t.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),t.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var i=new Uint8Array([105,115,111,54]),y=new Uint8Array([105,115,111,52]),p=new Uint8Array([105,115,111,53]),u=new Uint8Array([97,118,99,49]),c=new Uint8Array([104,118,99,49]),l=new Uint8Array([0,0,0,1]),f=new Uint8Array([100,97,115,104]);t.FTYP=n?t.box(t.types.ftyp,i,l,y,u,i,p,f):t.box(t.types.ftyp,i,l,y,c,i,p,f),t.DINF=t.box(t.types.dinf,t.box(t.types.dref,a))}},{key:"box",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];for(var o,a=8,s=n.length,i=s;s--;)a+=n[s].byteLength;for((o=new Uint8Array(a))[0]=a>>24&255,o[1]=a>>16&255,o[2]=a>>8&255,o[3]=255&a,o.set(t,4),s=0,a=8;s<i;++s)o.set(n[s],a),a+=n[s].byteLength;return o}},{key:"hdlr",value:function(e){return t.box(t.types.hdlr,t.HDLR_TYPES[e])}},{key:"mdat",value:function(e){return t.box(t.types.mdat,e)}},{key:"mdhd",value:function(e,n){return t.box(t.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))}},{key:"mdia",value:function(e){return t.box(t.types.mdia,t.mdhd(e.timescale,e.duration),t.hdlr(e.type),t.minf(e))}},{key:"mfhd",value:function(e){return t.box(t.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}},{key:"minf",value:function(e){return"audio"===e.type?t.box(t.types.minf,t.box(t.types.smhd,t.SMHD),t.DINF,t.stbl(e)):t.box(t.types.minf,t.box(t.types.vmhd,t.VMHD),t.DINF,t.stbl(e))}},{key:"moof",value:function(e,n,r){return t.box(t.types.moof,t.mfhd(e),t.traf(r,n))}},{key:"moov",value:function(e,n,r){for(var o=e.length,a=[];o--;)a[o]=t.trak(e[o]);return t.box.apply(null,[t.types.moov,t.mvhd(r,n)].concat(a).concat(t.mvex(e)))}},{key:"mvex",value:function(e){for(var n=e.length,r=[];n--;)r[n]=t.trex(e[n]);return t.box.apply(null,[t.types.mvex].concat(r))}},{key:"mvhd",value:function(e,n){var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,e>>24&255,e>>16&255,e>>8&255,255&e,n>>24&255,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return t.box(t.types.mvhd,r)}},{key:"sdtp",value:function(e){var n,r,o=e.samples||[],a=new Uint8Array(4+o.length);for(r=0;r<o.length;r++)n=o[r].flags,a[r+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return t.box(t.types.sdtp,a)}},{key:"stbl",value:function(e){return t.box(t.types.stbl,t.stsd(e),t.box(t.types.stts,t.STTS),t.box(t.types.stsc,t.STSC),t.box(t.types.stsz,t.STSZ),t.box(t.types.stco,t.STCO))}},{key:"avc1",value:function(e){var n,r,o,a=[],s=[];for(n=0;n<e.sps.length;n++)o=(r=e.sps[n]).byteLength,a.push(o>>>8&255),a.push(255&o),a=a.concat(Array.prototype.slice.call(r));for(n=0;n<e.pps.length;n++)o=(r=e.pps[n]).byteLength,s.push(o>>>8&255),s.push(255&o),s=s.concat(Array.prototype.slice.call(r));var i=t.box(t.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|e.sps.length].concat(a).concat([e.pps.length]).concat(s))),y=e.width,p=e.height;return t.box(t.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,y>>8&255,255&y,p>>8&255,255&p,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,98,105,110,101,108,112,114,111,46,114,117,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),i,t.box(t.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}},{key:"esds",value:function(t){var e=t.config.byteLength,n=new Uint8Array(26+e+3);return n.set([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5,e]),n.set(t.config,26),n.set([6,1,2],26+e),n}},{key:"hvc1",value:function(e){var n,r,o,a=[],s=[],i=[],y=e.vps.length;for(a.push(160),a.push(y>>>8&255),a.push(255&y),n=0;n<y;n++)o=(r=e.vps[n]).byteLength,a.push(o>>>8&255),a.push(255&o),a=a.concat(Array.prototype.slice.call(r));for(y=e.sps.length,s.push(161),s.push(y>>>8&255),s.push(255&y),n=0;n<y;n++)o=(r=e.sps[n]).byteLength,s.push(o>>>8&255),s.push(255&o),s=s.concat(Array.prototype.slice.call(r));for(y=e.pps.length,i.push(162),i.push(y>>>8&255),i.push(255&y),n=0;n<y;n++)o=(r=e.pps[n]).byteLength,i.push(o>>>8&255),i.push(255&o),i=i.concat(Array.prototype.slice.call(r));var p=t.box(t.types.hvcC,new Uint8Array([1,e.vpsconfig.GeneralProfileSpace<<6|e.vpsconfig.GeneralTierFlag<<5|e.vpsconfig.GeneralProfileIdc,e.vpsconfig.CompatibilityFlags>>24&255,e.vpsconfig.CompatibilityFlags>>16&255,e.vpsconfig.CompatibilityFlags>>8&255,255&e.vpsconfig.CompatibilityFlags,e.vpsconfig.ConstraintIdcFlags>>40&255,e.vpsconfig.ConstraintIdcFlags>>32&255,e.vpsconfig.ConstraintIdcFlags>>24&255,e.vpsconfig.ConstraintIdcFlags>>16&255,e.vpsconfig.ConstraintIdcFlags>>8&255,255&e.vpsconfig.ConstraintIdcFlags,e.vpsconfig.GeneralLevelIdc,240,0,252,252|e.vpsconfig.ChromaFormatIdc,248|e.vpsconfig.BitDepthLumaMinus8,248|e.vpsconfig.BitDepthChromaMinus8,0,0,3,3].concat(a).concat(s).concat(i))),u=e.width,c=e.height;return t.box(t.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,255&u,c>>8&255,255&c,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,98,105,110,101,108,112,114,111,46,114,117,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),p,t.box(t.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}},{key:"mp4a",value:function(e){var n=e.audiosamplerate;return t.box(t.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]),t.box(t.types.esds,t.esds(e)))}},{key:"stsd",value:function(e){return"audio"===e.type?t.box(t.types.stsd,t.STSD,t.mp4a(e)):e.vps?t.box(t.types.stsd,t.STSD,t.hvc1(e)):t.box(t.types.stsd,t.STSD,t.avc1(e))}},{key:"tkhd",value:function(e){var n=e.id,r=e.duration,o=e.width,a=e.height,s=e.volume;return t.box(t.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,s>>0&255,s%1*10>>0&255,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,o>>8&255,255&o,0,0,a>>8&255,255&a,0,0]))}},{key:"traf",value:function(e,n){var r=t.sdtp(e),o=e.id;return t.box(t.types.traf,t.box(t.types.tfhd,new Uint8Array([0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o])),t.box(t.types.tfdt,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),t.trun(e,r.length+16+16+8+16+8+8),r)}},{key:"trak",value:function(e){return e.duration=e.duration||4294967295,t.box(t.types.trak,t.tkhd(e),t.mdia(e))}},{key:"trex",value:function(e){var n=e.id;return t.box(t.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(e,n){var r,o,a,s,i,y,p=e.samples||[],u=p.length,c=12+16*u,l=new Uint8Array(c);for(n+=8+c,l.set([0,0,15,1,u>>>24&255,u>>>16&255,u>>>8&255,255&u,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0),r=0;r<u;r++)a=(o=p[r]).duration,s=o.size,i=o.flags,y=o.cts,l.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,s>>>24&255,s>>>16&255,s>>>8&255,255&s,i.isLeading<<2|i.dependsOn,i.isDependedOn<<6|i.hasRedundancy<<4|i.paddingValue<<1|i.isNonSync,61440&i.degradPrio,15&i.degradPrio,y>>>24&255,y>>>16&255,y>>>8&255,255&y],12+16*r);return t.box(t.types.trun,l)}},{key:"initSegment",value:function(e,n,r,o){t.types||t.init(e);var a,s=t.moov(n,r,o);return(a=new Uint8Array(t.FTYP.byteLength+s.byteLength)).set(t.FTYP),a.set(s,t.FTYP.byteLength),a}}]),t}();
},{}],"hb8a":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MSEBuffer=exports.MSE=void 0;var e=require("../utils/event.js"),r=require("../utils/logger.js");function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,r,t){return(r=f(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function u(e,r){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=i(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var n=0,u=function(){};return{s:u,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:u}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==t.return||t.return()}finally{if(a)throw o}}}}function i(e,r){if(e){if("string"==typeof e)return o(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?o(e,r):void 0}}function o(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function s(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function a(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function c(e,r,t){return r&&a(e.prototype,r),t&&a(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function f(e){var r=d(e,"string");return"symbol"===t(r)?r:String(r)}function d(e,r){if("object"!==t(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var u=n.call(e,r||"default");if("object"!==t(u))return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}var l="mse",h=(0,r.getTagged)(l),p=exports.MSEBuffer=function(){function r(t,n){var u=this;s(this,r),this.mediaSource=t.mediaSource,this.players=t.players,this.cleaning=!1,this.parent=t,this.queue=[],this.cleanResolvers=[],this.codec=n,this.cleanRanges=[],this.updatesToCleanup=0,this.firstMoveToBufferStart=!0,h.debug("Use codec: ".concat(n)),this.sourceBuffer=this.mediaSource.addSourceBuffer(n),this.eventSource=new e.EventEmitter(this.sourceBuffer),this.eventSource.addEventListener("updatestart",function(e){u.cleaning&&h.debug("".concat(u.codec," cleaning start"))}),this.eventSource.addEventListener("update",function(e){u.cleaning&&h.debug("".concat(u.codec," cleaning update"))}),this.eventSource.addEventListener("updateend",function(e){if(u.cleaning){h.debug("".concat(u.codec," cleaning end"));try{u.sourceBuffer.buffered.length&&u.players[0].currentTime<u.sourceBuffer.buffered.start(0)&&(u.players[0].currentTime=u.sourceBuffer.buffered.start(0))}catch(e){}for(;u.cleanResolvers.length;){u.cleanResolvers.shift()()}if(u.cleaning=!1,u.cleanRanges.length)return void u.doCleanup()}u.sourceBuffer.updating||(u.parent.setDurationInfinity(),u.updatesToCleanup++,u.updatesToCleanup>100&&(u.cleanupBuffer(),u.updatesToCleanup=0),u.feedNext())}),this.eventSource.addEventListener("error",function(e){h.debug("Source buffer error: ".concat(u.mediaSource.readyState)),u.mediaSource.sourceBuffers.length&&u.mediaSource.removeSourceBuffer(u.sourceBuffer),u.parent.eventSource.dispatchEvent("error",e)}),this.eventSource.addEventListener("abort",function(e){h.debug("Source buffer aborted: ".concat(u.mediaSource.readyState)),u.mediaSource.sourceBuffers.length&&u.mediaSource.removeSourceBuffer(u.sourceBuffer),u.parent.eventSource.dispatchEvent("error",e)}),this.sourceBuffer.updating||this.feedNext()}return c(r,[{key:"cleanupBuffer",value:function(){if(this.sourceBuffer.buffered.length&&!this.sourceBuffer.updating){var e=this.players[0].currentTime,r=this.sourceBuffer.buffered.start(0),t=this.sourceBuffer.buffered.end(0),n=t-r,u=t-this.parent.bufferDuration;if(u>0&&n>this.parent.bufferDuration&&e>r&&e>u)try{this.sourceBuffer.remove(r,u)}catch(i){h.warn("Failed to cleanup buffer"),this.parent.eventSource.dispatchEvent("error",i)}}}},{key:"destroy",value:function(){this.eventSource.destroy(),this.clear(),this.queue=[],this.mediaSource.removeSourceBuffer(this.sourceBuffer)}},{key:"clear",value:function(){var e=this;this.queue=[];for(var r=[],t=function(t){e.cleaning=!0,r.push(new Promise(function(r,n){e.cleanResolvers.push(r),e.sourceBuffer.updating?e.sourceBuffer.onupdateend=function(){e.sourceBuffer&&e.sourceBuffer.remove(e.sourceBuffer.buffered.start(t),e.sourceBuffer.buffered.end(t)),r()}:(e.sourceBuffer.remove(e.sourceBuffer.buffered.start(t),e.sourceBuffer.buffered.end(t)),r())}))},n=0;n<this.sourceBuffer.buffered.length;++n)t(n);return Promise.all(r)}},{key:"setLive",value:function(e){this.is_live=e}},{key:"feedNext",value:function(){this.sourceBuffer.updating||this.cleaning||!this.queue.length||this.doAppend(this.queue.shift())}},{key:"doCleanup",value:function(){if(!this.cleanRanges.length)return this.cleaning=!1,void this.feedNext();var e=this.cleanRanges.shift();h.debug("".concat(this.codec," remove range [").concat(e[0]," - ").concat(e[1],"). \n                  \nUpdating: ").concat(this.sourceBuffer.updating,"\n                  ")),this.cleaning=!0,this.sourceBuffer.remove(e[0],e[1])}},{key:"initCleanup",value:function(){if(!this.sourceBuffer.buffered.length||this.sourceBuffer.updating||this.cleaning)this.feedNext();else{h.debug("".concat(this.codec," cleanup"));for(var e=this.sourceBuffer.buffered.end(this.sourceBuffer.buffered.length-1)-2,r=0;r<this.sourceBuffer.buffered.length;++r){var t=this.sourceBuffer.buffered.start(r),n=this.sourceBuffer.buffered.end(r);this.players[0].currentTime<=t||e<=t||(e<=n&&e>=t?(h.debug("Clear [".concat(t,", ").concat(e,"], leave [").concat(e,", ").concat(n,"]")),(n=e)!=t&&this.cleanRanges.push([t,n])):this.cleanRanges.push([t,n]))}this.doCleanup()}}},{key:"doAppend",value:function(e){var r=this.players[0].error;if(r){h.error("Error occured: ".concat(v.ErrorNotes[r.code]));try{this.players.forEach(function(e){e.stop()}),this.mediaSource.endOfStream()}catch(t){}this.parent.eventSource.dispatchEvent("error")}else try{this.sourceBuffer.appendBuffer(e),this.firstMoveToBufferStart&&this.sourceBuffer.buffered.length&&(this.players[0].currentTime=this.sourceBuffer.buffered.start(0),this.players[0].autoPlay&&this.players[0].start(),this.firstMoveToBufferStart=!1)}catch(t){if("QuotaExceededError"===t.name)return h.debug("".concat(this.codec," quota fail")),this.queue.unshift(e),void this.initCleanup();h.error("Error occured while appending buffer. ".concat(t.name,": ").concat(t.message)),this.parent.eventSource.dispatchEvent("error")}}},{key:"feed",value:function(e){this.queue=this.queue.concat(e),!this.sourceBuffer||this.sourceBuffer.updating||this.cleaning||this.feedNext()}}]),r}(),v=exports.MSE=function(){function r(t){s(this,r),this.players=t;var n=this.players.map(function(e,r){return e.onplaying=function(){n[r]=!0},e.onpause=function(){n[r]=!1},!e.paused});this.playing=n,this.bufferDuration_=120,this.mediaSource=new MediaSource,this.eventSource=new e.EventEmitter(this.mediaSource),this.reset()}return c(r,[{key:"setDurationInfinity",value:function(){for(var e in this.buffers)if(this.buffers[e].sourceBuffer.updating)return;this.mediaSource.duration!==Number.POSITIVE_INFINITY&&0===this.players[0].currentTime&&this.mediaSource.duration>0&&(this.players[0].currentTime=this.mediaSource.duration-1,this.mediaSource.duration=Number.POSITIVE_INFINITY)}},{key:"bufferDuration",get:function(){return this.bufferDuration_},set:function(e){this.bufferDuration_=e}},{key:"destroy",value:function(){this.reset(),this.eventSource.destroy(),this.mediaSource=null,this.eventSource=null}},{key:"play",value:function(){var e=this;this.players.forEach(function(r,t){r.paused&&!e.playing[t]&&(h.debug("player ".concat(t,": play")),r.play())})}},{key:"setLive",value:function(e){for(var r in this.buffers)this.buffers[r].setLive(e);this.is_live=e}},{key:"resetBuffers",value:function(){var e=this;this.players.forEach(function(r,t){!r.paused&&e.playing[t]&&(r.pause(),r.currentTime=0)});var r,t=[],n=u(this.buffers.values());try{for(n.s();!(r=n.n()).done;){var i=r.value;t.push(i.clear())}}catch(o){n.e(o)}finally{n.f()}return Promise.all(t).then(function(){e.mediaSource.endOfStream(),e.mediaSource.duration=0,e.mediaSource.clearLiveSeekableRange(),e.play()})}},{key:"clear",value:function(){var e=this;return this.reset(),this.players.forEach(function(r){r.src=URL.createObjectURL(e.mediaSource)}),this.setupEvents()}},{key:"setupEvents",value:function(){var e=this;return this.eventSource.clear(),this.resolved=!1,this.mediaReady=new Promise(function(r,t){e._sourceOpen=function(){h.debug("Media source opened: ".concat(e.mediaSource.readyState)),e.resolved||(e.resolved=!0,r())},e._sourceEnded=function(){h.debug("Media source ended: ".concat(e.mediaSource.readyState))},e._sourceClose=function(){h.debug("Media source closed: ".concat(e.mediaSource.readyState)),e.resolved&&e.eventSource.dispatchEvent("sourceclosed")},e.eventSource.addEventListener("sourceopen",e._sourceOpen),e.eventSource.addEventListener("sourceended",e._sourceEnded),e.eventSource.addEventListener("sourceclose",e._sourceClose)}),this.mediaReady}},{key:"reset",value:function(){for(var e in this.ready=!1,this.buffers)this.buffers[e].destroy(),delete this.buffers[e];"open"==this.mediaSource.readyState&&(this.mediaSource.duration=0,this.mediaSource.endOfStream()),this.updating=!1,this.resolved=!1,this.buffers={}}},{key:"setCodec",value:function(e,r){var t=this;return this.mediaReady.then(function(){t.buffers[e]=new p(t,r),t.buffers[e].setLive(t.is_live)})}},{key:"feed",value:function(e,r){this.buffers[e]&&this.buffers[e].feed(r)}}],[{key:"ErrorNotes",get:function(){return n(n(n(n({},MediaError.MEDIA_ERR_ABORTED,"fetching process aborted by user"),MediaError.MEDIA_ERR_NETWORK,"error occurred when downloading"),MediaError.MEDIA_ERR_DECODE,"error occurred when decoding"),MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED,"audio/video not supported")}},{key:"isSupported",value:function(e){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="'.concat(e.join(","),'"'))}}]),r}();
},{"../utils/event.js":"Dnsu","../utils/logger.js":"xVgw"}],"AvRn":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BaseRemuxer=void 0;var t=require("../utils/logger.js");function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,s(i.key),i)}}function r(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t){var n=u(t,"string");return"symbol"===e(n)?n:String(n)}function u(t,n){if("object"!==e(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,n||"default");if("object"!==e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}var o=(0,t.getTagged)("remuxer:base"),a=1,l=exports.BaseRemuxer=function(){function t(e,i,r){n(this,t),this.timeOffset=0,this.timescale=e,this.scaleFactor=i,this.readyToDecode=!1,this.samples=[],this.seq=1,this.tsAlign=1}return r(t,[{key:"scaled",value:function(t){return t/this.scaleFactor}},{key:"unscaled",value:function(t){return t*this.scaleFactor}},{key:"remux",value:function(t){return!!t&&(this.samples.push({unit:t,pts:t.pts,dts:t.dts}),!0)}},{key:"setConfig",value:function(t){}},{key:"insertDscontinuity",value:function(){this.samples.push(null)}},{key:"init",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.initPTS=Math.min(t,this.samples[0].dts),this.initDTS=Math.min(e,this.samples[0].dts),o.debug("Initial pts=".concat(this.initPTS," dts=").concat(this.initDTS," offset=").concat(this.unscaled(this.timeOffset))),this.initialized=n}},{key:"flush",value:function(){this.seq++,this.mp4track.len=0,this.mp4track.samples=[]}},{key:"getPayloadBase",value:function(e,n){return this.readyToDecode&&this.initialized&&this.samples.length?(this.samples.sort(t.dtsSortFunc),!0):null}}],[{key:"MP4_TIMESCALE",get:function(){return 9e4}},{key:"getTrackID",value:function(){return a++}},{key:"toMS",value:function(t){return t/90}},{key:"dtsSortFunc",value:function(t,e){return t.dts-e.dts}},{key:"groupByDts",value:function(t){var e;return e="dts",t.reduce(function(t,n){return(t[n[e]]=t[n[e]]||[]).push(n),t},{})}}]),t}();
},{"../utils/logger.js":"xVgw"}],"E10R":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AACRemuxer=void 0;var t=require("../utils/logger.js"),e=require("../presentation/mse.js"),r=require("./base-remuxer.js");function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,s(n.key),n)}}function a(t,e,r){return e&&o(t.prototype,e),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t){var e=c(t,"string");return"symbol"===n(e)?e:String(e)}function c(t,e){if("object"!==n(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function u(){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=l(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}}).apply(this,arguments)}function l(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=g(t)););return t}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&p(t,e)}function p(t,e){return(p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function d(t){var e=y();return function(){var r,n=g(t);if(e){var i=g(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return h(this,r)}}function h(t,e){if(e&&("object"===n(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return m(t)}function m(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function y(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var b=(0,t.getTagged)("remuxer:aac"),v=exports.AACRemuxer=function(t){f(o,r.BaseRemuxer);var n=d(o);function o(t){var a,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return i(this,o),(a=n.call(this,t,s)).codecstring=e.MSE.CODEC_AAC,a.units=[],a.initDTS=void 0,a.nextAacPts=void 0,a.lastPts=0,a.firstDTS=0,a.firstPTS=0,a.duration=c.duration||1,a.initialized=!1,a.mp4track={id:r.BaseRemuxer.getTrackID(),type:"audio",fragmented:!0,channelCount:0,audiosamplerate:a.timescale,duration:0,timescale:a.timescale,volume:1,samples:[],config:"",len:0},c.config&&a.setConfig(c.config),a}return a(o,[{key:"setConfig",value:function(t){this.mp4track.channelCount=t.channels,this.mp4track.audiosamplerate=t.samplerate,this.mp4track.duration||(this.mp4track.duration=(this.duration?this.duration:1)*t.samplerate),this.mp4track.timescale=t.samplerate,this.mp4track.config=t.config,this.mp4track.codec=t.codec,this.timescale=t.samplerate,this.scaleFactor=r.BaseRemuxer.MP4_TIMESCALE/t.samplerate,this.expectedSampleDuration=1024*this.scaleFactor,this.readyToDecode=!0}},{key:"remux",value:function(t){u(g(o.prototype),"remux",this).call(this,t)&&(this.mp4track.len+=t.getSize())}},{key:"getPayload",value:function(){if(!this.readyToDecode||!this.samples.length)return null;this.samples.sort(function(t,e){return t.dts-e.dts});for(var t,e,r,n,i=new Uint8Array(this.mp4track.len),o=0,a=this.mp4track.samples;this.samples.length;){var s=this.samples.shift();if(null===s){this.nextDts=void 0;break}var c=s.unit;if(r=s.pts-this.initDTS,n=s.dts-this.initDTS,void 0===e){if(this.nextDts){var u=Math.round(this.scaled(r-this.nextAacPts));if(Math.abs(u)<600&&u){if(u>0)b.log("".concat(u," ms hole between AAC samples detected,filling it"));else if(u<-12){b.log("".concat(-u," ms overlapping between AAC samples detected, drop frame")),this.mp4track.len-=c.getSize();continue}r=n=this.nextAacPts}}this.firstDTS=Math.max(0,n)}t={size:c.getSize(),cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},i.set(c.getData(),o),o+=c.getSize(),a.push(t),e=n}return a.length?(this.nextDts=r+this.expectedSampleDuration,new Uint8Array(i.buffer,0,this.mp4track.len)):null}}]),o}();
},{"../utils/logger.js":"xVgw","../presentation/mse.js":"hb8a","./base-remuxer.js":"AvRn"}],"oeMZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ExpGolomb=void 0;var t=require("../utils/logger.js");function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,n(r.key),r)}}function a(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function n(t){var i=s(t,"string");return"symbol"===e(i)?i:String(i)}function s(t,i){if("object"!==e(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var a=r.call(t,i||"default");if("object"!==e(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}var o=exports.ExpGolomb=function(){function e(t){i(this,e),this.data=t,this.bytesAvailable=this.data.byteLength,this.word=0,this.bitsAvailable=0}return a(e,[{key:"numBitsLeft",value:function(){return 8*this.bytesAvailable+this.bitsAvailable}},{key:"loadWord",value:function(){var t=this.data.byteLength-this.bytesAvailable,e=new Uint8Array(4),i=Math.min(4,this.bytesAvailable);if(0===i)throw new Error("no bytes available");e.set(this.data.subarray(t,t+i)),this.word=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i}},{key:"skipBits",value:function(t){var e;this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,t-=(e=t>>3)<<3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)}},{key:"readBits",value:function(e){var i=Math.min(this.bitsAvailable,e),r=this.word>>>32-i;return e>32&&t.Log.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=i,this.bitsAvailable>0?this.word<<=i:this.bytesAvailable>0&&this.loadWord(),(i=e-i)>0?r<<i|this.readBits(i):r}},{key:"skipLZ",value:function(){var t;for(t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var t=this.skipLZ();return this.readBits(t+1)-1}},{key:"readEG",value:function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}}],[{key:"removeH264or5EmulationBytes",value:function(t){for(var e=t.byteLength,i=0,r=0,a=new Uint8Array(e);i<e;)i+2<e&&0===t[i]&&0===t[i+1]&&3===t[i+2]?(a[r]=a[r+1]=0,r+=2,i+=3):(a[r]=t[i],r+=1,i+=1);return a.subarray(0,r)}}]),e}();
},{"../utils/logger.js":"xVgw"}],"gPsu":[function(require,module,exports) {
"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,i(n.key),n)}}function n(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function i(e){var r=o(e,"string");return"symbol"===t(r)?r:String(r)}function o(e,r){if("object"!==t(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,r||"default");if("object"!==t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}function s(t,e){var r=new Uint8Array((0|t.byteLength)+(0|e.byteLength));return r.set(t,0),r.set(e,0|t.byteLength),r}function a(t,e){return new Promise(function(r,n){var i=new Blob([t,e]),o=new FileReader;o.addEventListener("loadend",function(){r()}),o.readAsArrayBuffer(i)})}function u(t){for(var e=window.atob(t),r=e.length,n=new Uint8Array(r),i=0;i<r;i++)n[i]=e.charCodeAt(i);return n.buffer}function y(t){for(var e=t.length>>1,r=new Uint8Array(e),n=0;n<e;n++)r[n]=parseInt(t.substr(n<<1,2),16);return r}function f(t){for(var e=0,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];for(var o=0,s=n;o<s.length;o++){e+=s[o].length}for(var a=new t(e),u=0,y=0,f=n;y<f.length;y++){var b=f[y];a.set(b,u),u+=b.length}return a}function b(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8*t.byteLength,n=Math.ceil((r-e)/8),i=new Uint8Array(n),o=e>>>3,s=(r>>>3)-1,a=7&e,u=8-a,y=8-r&7,f=0;f<n;++f){var b=0;f<s&&(b=t[o+f+1]>>u,f===s-1&&y<8&&(b>>=y,b<<=y)),i[f]=t[o+f]<<a|b}return i}Object.defineProperty(exports,"__esModule",{value:!0}),exports.BitArray=void 0,exports.appendByteArray=s,exports.appendByteArrayAsync=a,exports.base64ToArrayBuffer=u,exports.bitSlice=b,exports.concatenate=f,exports.hexToByteArray=y;var h=exports.BitArray=function(){function t(r){e(this,t),this.src=new DataView(r.buffer,r.byteOffset,r.byteLength),this.bitpos=0,this.byte=this.src.getUint8(0),this.bytepos=0}return n(t,[{key:"readBits",value:function(t){if(32<(0|t)||0==(0|t))throw new Error("too big");for(var e=0,r=t;r>0;--r)e=(0|e)<<1|(0|this.byte)>>8-++this.bitpos&1,(0|this.bitpos)>=8&&(this.byte=this.src.getUint8(++this.bytepos),this.bitpos&=7);return e}},{key:"skipBits",value:function(t){return this.bitpos+=7&(0|t),this.bytepos+=(0|t)>>>3,this.bitpos>7&&(this.bitpos&=7,++this.bytepos),this.finished()?this.bytepos-this.src.byteLength-this.src.bitpos:(this.byte=this.src.getUint8(this.bytepos),0)}},{key:"finished",value:function(){return this.bytepos>=this.src.byteLength}}]),t}();
},{}],"lqH2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.NALU=void 0;var t=require("../utils/binary.js");function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e,n){return(e=o(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,o(r.key),r)}}function u(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function o(t){var n=a(t,"string");return"symbol"===e(n)?n:String(n)}function a(t,n){if("object"!==e(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,n||"default");if("object"!==e(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}var y=exports.NALU=function(){function e(t,n,i,u,o){r(this,e),this.data=i,this.ntype=t,this.nri=n,this.dts=u,this.pts=o,this.sliceType=null}return u(e,[{key:"appendData",value:function(e){this.data=(0,t.appendByteArray)(this.data,e)}},{key:"toString",value:function(){return"".concat(e.type(this),"(").concat(this.data.byteLength,"): NRI: ").concat(this.getNri(),", PTS: ").concat(this.pts,", DTS: ").concat(this.dts)}},{key:"getNri",value:function(){return this.nri>>>5}},{key:"type",value:function(){return this.ntype}},{key:"isKeyframe",value:function(){return this.ntype===e.IDR||7===this.sliceType}},{key:"getSize",value:function(){return 5+this.data.byteLength}},{key:"getData",value:function(){var t=new Uint8Array(5+this.data.byteLength),e=new DataView(t.buffer);return e.setUint32(0,this.data.byteLength+1),e.setUint8(4,0|96&this.nri|31&this.ntype),t.set(this.data,5),t}}],[{key:"NDR",get:function(){return 1}},{key:"SLICE_PART_A",get:function(){return 2}},{key:"SLICE_PART_B",get:function(){return 3}},{key:"SLICE_PART_C",get:function(){return 4}},{key:"IDR",get:function(){return 5}},{key:"SEI",get:function(){return 6}},{key:"SPS",get:function(){return 7}},{key:"PPS",get:function(){return 8}},{key:"DELIMITER",get:function(){return 9}},{key:"EOSEQ",get:function(){return 10}},{key:"EOSTR",get:function(){return 11}},{key:"FILTER",get:function(){return 12}},{key:"STAP_A",get:function(){return 24}},{key:"STAP_B",get:function(){return 25}},{key:"FU_A",get:function(){return 28}},{key:"FU_B",get:function(){return 29}},{key:"TYPES",get:function(){return n(n(n(n(n({},e.IDR,"IDR"),e.SEI,"SEI"),e.SPS,"SPS"),e.PPS,"PPS"),e.NDR,"NDR")}},{key:"type",value:function(t){return t.ntype in e.TYPES?e.TYPES[t.ntype]:"UNKNOWN"}}]),e}();
},{"../utils/binary.js":"gPsu"}],"DOUY":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.H264Parser=void 0;var e=require("./exp-golomb.js"),r=require("./nalu.js"),a=require("../utils/ASMediaError.js");function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function s(e,r){for(var a=0;a<r.length;a++){var t=r[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,o(t.key),t)}}function n(e,r,a){return r&&s(e.prototype,r),a&&s(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e){var r=c(e,"string");return"symbol"===t(r)?r:String(r)}function c(e,r){if("object"!==t(e)||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var i=a.call(e,r||"default");if("object"!==t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}var u=exports.H264Parser=function(){function t(e){i(this,t),this.track=e,this.firstFound=!1}return n(t,[{key:"parseSPS",value:function(e){var r=t.readSPS(new Uint8Array(e));this.track.width=r.width,this.track.height=r.height,this.track.hasBFrames=r.hasBFrames,this.track.sps=[new Uint8Array(e)],this.track.codec=t.getCodec(e)}},{key:"parsePPS",value:function(e){this.track.pps=[new Uint8Array(e)]}},{key:"parseNAL",value:function(e){if(!e)return!1;var a=null;switch(e.type()){case r.NALU.NDR:case r.NALU.IDR:e.sliceType=t.parceSliceHeader(e.data),e.isKeyframe()&&!this.firstFound&&(this.firstFound=!0),a=!!this.firstFound;break;case r.NALU.PPS:a=!1,this.track.pps||this.parsePPS(e.getData().subarray(4));break;case r.NALU.SPS:a=!1,this.track.sps||this.parseSPS(e.getData().subarray(4));break;case r.NALU.SEI:a=!1;var i=new DataView(e.data.buffer,e.data.byteOffset,e.data.byteLength),s=0;i.getUint8(s);++s;var n=i.getUint8(s);for(++s;255===n;)n,n=i.getUint8(s),++s;n;e.data.subarray(s,s+16);s+=16;break;case r.NALU.EOSEQ:case r.NALU.EOSTR:a=!1}return null===a&&e.getNri()>0&&(a=!0),a}}],[{key:"getCodec",value:function(e){for(var r="avc1.",a=new DataView(e.buffer,e.byteOffset+1,4),t=0;t<3;++t){var i=a.getUint8(t).toString(16);i.length<2&&(i="0"+i),r+=i}return r}},{key:"parceSliceHeader",value:function(r){var a=new e.ExpGolomb(r);a.skipUEG();var t=a.readUEG();return a.skipUEG(),a.skipBits(8),t}},{key:"skipScalingList",value:function(e,r){for(var a=8,t=8,i=0;i<r;i++)0!==t&&(t=(a+e.readEG()+256)%256),a=0===t?a:t}},{key:"readSPS",value:function(r){r=e.ExpGolomb.removeH264or5EmulationBytes(r);var i,s,n,o,c,u,p=new e.ExpGolomb(r),l=0,k=0,d=0,f=0,b=1,y=!0,v=0;if(p.skipBits(8),i=p.readUByte(),p.skipBits(5),p.skipBits(3),p.skipBits(8),p.skipUEG(),100===i||110===i||122===i||244===i||44===i||83===i||86===i||118===i||128===i){var U=p.readUEG();if(3===U&&p.skipBits(1),p.skipUEG(),p.skipUEG(),p.skipBits(1),p.readBoolean()){u=3!==U?8:12;for(var E=0;E<u;++E)p.readBoolean()&&(E<6?t.skipScalingList(p,16):t.skipScalingList(p,64))}}p.skipUEG();var h=p.readUEG();if(0===h)p.readUEG();else if(1===h){p.skipBits(1),p.skipEG(),p.skipEG(),s=p.readUEG();for(var B=0;B<s;++B)p.skipEG()}if(p.skipUEG(),p.skipBits(1),n=p.readUEG(),o=p.readUEG(),0===(c=p.readBits(1))&&p.skipBits(1),p.skipBits(1),p.readBoolean()&&(l=p.readUEG(),k=p.readUEG(),d=p.readUEG(),f=p.readUEG()),p.readBoolean()){if(p.readBoolean()){var S,m=p.readUByte();switch(m){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:S=[p.readUByte()<<8|p.readUByte(),p.readUByte()<<8|p.readUByte()];break;default:throw new a.ASMediaError(a.ASMediaError.MEDIA_ERR_DECODE,"Invalid avc sps aspectRatioIdc: ".concat(m))}S&&(b=S[0]/S[1])}if(p.readBoolean()&&p.skipBits(1),p.readBoolean()&&(p.skipBits(4),p.readBoolean()&&p.skipBits(24)),p.readBoolean()&&(p.skipUEG(),p.skipUEG()),p.readBoolean()){var G=p.readUInt(),g=p.readUInt();y=p.readBoolean(),v=g/(2*G),console.log("timescale: ".concat(g,"; unitsInTick: ").concat(G,"; fixedFramerate: ").concat(y,"; avgFrameDuration: ").concat(v))}}return{width:Math.ceil((16*(n+1)-2*l-2*k)*b),height:(2-c)*(o+1)*16-(c?2:4)*(d+f),hasBFrames:2!==h,fixedFrameRate:y,frameDuration:v}}},{key:"readSliceType",value:function(e){return e.skipBits(8),e.skipUEG(),e.readUEG()}}]),t}();
},{"./exp-golomb.js":"oeMZ","./nalu.js":"lqH2","../utils/ASMediaError.js":"yB1D"}],"bPIX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.H264Remuxer=void 0;var t=require("../utils/logger.js"),e=require("../parsers/h264.js"),r=require("./base-remuxer.js");function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=o(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return s=t.done,t},e:function(t){u=!0,a=t},f:function(){try{s||null==r.return||r.return()}finally{if(u)throw a}}}}function o(t,e){if(t){if("string"==typeof t)return a(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(t,e):void 0}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,l(n.key),n)}}function c(t,e,r){return e&&u(t.prototype,e),r&&u(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function l(t){var e=f(t,"string");return"symbol"===n(e)?e:String(e)}function f(t,e){if("object"!==n(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function p(){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=h(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}}).apply(this,arguments)}function h(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=S(t)););return t}function d(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&y(t,e)}function y(t,e){return(y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function m(t){var e=b();return function(){var r,n=S(t);if(e){var i=S(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return v(this,r)}}function v(t,e){if(e&&("object"===n(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return g(t)}function g(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function b(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function S(t){return(S=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var D=(0,t.getTagged)("remuxer:h264"),P=exports.H264Remuxer=function(t){d(o,r.BaseRemuxer);var n=m(o);function o(t){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(s(this,o),(i=n.call(this,t,a)).nextDts=void 0,i.readyToDecode=!1,i.initialized=!1,i.firstDTS=0,i.firstPTS=0,i.lastDTS=void 0,i.lastSampleDuration=0,i.lastDurations=[],i.tsAlign=Math.round(i.timescale/60),i.mp4track={id:r.BaseRemuxer.getTrackID(),type:"video",len:0,fragmented:!0,sps:"",pps:"",width:0,height:0,timescale:t,duration:t,samples:[]},i.samples=[],i.lastGopDTS=-99999999999999,i.gop=[],i.firstUnit=!0,i.h264=new e.H264Parser(i.mp4track),u.sps){var c=new Uint8Array(u.sps);7==(31&c[0])?i.setSPS(c):D.warn("bad SPS in SDP")}if(u.pps){var l=new Uint8Array(u.pps);8==(31&l[0])?i.setPPS(l):D.warn("bad PPS in SDP")}return i.mp4track.pps&&i.mp4track.sps&&(i.readyToDecode=!0),i}return c(o,[{key:"_scaled",value:function(t){return t>>>this.scaleFactor}},{key:"_unscaled",value:function(t){return t<<this.scaleFactor}},{key:"setSPS",value:function(t){this.h264.parseSPS(t)}},{key:"setPPS",value:function(t){this.h264.parsePPS(t)}},{key:"remux",value:function(t){if(this.lastGopDTS<t.dts){if(this.gop.sort(r.BaseRemuxer.dtsSortFunc),this.gop.length>1){var e=r.BaseRemuxer.groupByDts(this.gop);this.gop=Object.values(e).map(function(t){return t.reduce(function(t,e){var r=e.getData();return r.set(new Uint8Array([0,0,0,1])),t.appendData(r),t})})}var n,a=i(this.gop);try{for(a.s();!(n=a.n()).done;){var s=n.value;p(S(o.prototype),"remux",this).call(this,s)&&(this.mp4track.len+=s.getSize())}}catch(u){a.e(u)}finally{a.f()}this.gop=[],this.lastGopDTS=t.dts}this.h264.parseNAL(t)&&this.gop.push(t),!this.readyToDecode&&this.mp4track.pps&&this.mp4track.sps&&(this.readyToDecode=!0)}},{key:"getPayload",value:function(){if(!this.getPayloadBase())return null;for(var t,e,n,i,o=new Uint8Array(this.mp4track.len),a=0,s=this.mp4track.samples;this.samples.length;){var u=this.samples.shift();if(null===u){this.nextDts=void 0;break}var c=u.unit;if(n=u.pts-this.initDTS,i=u.dts-this.initDTS,i=Math.min(n,i),void 0!==e){var l=this.scaled(i-e);if(l<0){D.log("invalid AVC sample duration at PTS/DTS: ".concat(n,"/").concat(i,"|lastDTS: ").concat(e,":").concat(l)),this.mp4track.len-=c.getSize();continue}this.lastDurations.push(l),this.lastDurations.length>100&&this.lastDurations.shift(),t.duration=l}else{if(this.nextDts){var f=i-this.nextDts;if(Math.abs(Math.round(r.BaseRemuxer.toMS(f)))<600)f&&(i=this.nextDts,n=Math.max(n-f,i));else if(f<0){D.log("skip frame from the past at DTS=".concat(i," with expected DTS=").concat(this.nextDts)),this.mp4track.len-=c.getSize();continue}}this.firstDTS=Math.max(0,i)}var p=(t={size:c.getSize(),duration:0,cts:this.scaled(n-i),flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,isNonSync:0}}).flags;!0===u.unit.isKeyframe()?(p.dependsOn=2,p.isDependedOn=1,p.isNonSync=0):(p.dependsOn=1,p.isDependedOn=1,p.isNonSync=1),o.set(c.getData(),a),a+=c.getSize(),s.push(t),e=i}if(!s.length)return null;var h=this.lastDurations.reduce(function(t,e){return(0|t)+(0|e)},0)/(this.lastDurations.length||1)|0;if(s.length>=2?(this.lastSampleDuration=h,t.duration=h):t.duration=this.lastSampleDuration,s.length&&(!this.nextDts||navigator.userAgent.toLowerCase().indexOf("chrome")>-1)){var d=s[0].flags;d.dependsOn=2,d.isNonSync=0}return this.nextDts=i+this.unscaled(this.lastSampleDuration),new Uint8Array(o.buffer,0,this.mp4track.len)}}]),o}();
},{"../utils/logger.js":"xVgw","../parsers/h264.js":"DOUY","./base-remuxer.js":"AvRn"}],"fVMu":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.HEVC_NALU=void 0;var t=require("../utils/binary.js");function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e,n){return(e=o(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,o(r.key),r)}}function u(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function o(t){var n=_(t,"string");return"symbol"===e(n)?n:String(n)}function _(t,n){if("object"!==e(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,n||"default");if("object"!==e(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}var S=exports.HEVC_NALU=function(){function e(t,n,i,u,o,_){r(this,e),this.data=u,this.ntype=t,this.layerid=n,this.tid=i,this.dts=o,this.pts=_,this.sliceType=null}return u(e,[{key:"appendData",value:function(e){this.data=(0,t.appendByteArray)(this.data,e)}},{key:"toString",value:function(){return"".concat(e.type(this),"(").concat(this.data.byteLength,"): LayerID: ").concat(this.getLayerID(),", TID: ").concat(this.getTID(),", PTS: ").concat(this.pts,", DTS: ").concat(this.dts)}},{key:"getLayerID",value:function(){return this.layerid}},{key:"getTID",value:function(){return this.tid}},{key:"type",value:function(){return this.ntype}},{key:"isKeyframe",value:function(){return this.ntype===e.SLICE_IDR_N_LP||this.ntype===e.SLICE_IDR_W_RADL}},{key:"isRAP",value:function(){return this.ntype>=e.SLICE_BLA_W_LP&&this.ntype<=e.SLICE_RSV_IRAP_VCL23}},{key:"getSize",value:function(){return 6+this.data.byteLength}},{key:"getData",value:function(){var t=new Uint8Array(6+this.data.byteLength),e=new DataView(t.buffer);return e.setUint32(0,this.data.byteLength+2),e.setUint8(4,this.ntype<<1&126|this.layerid>>>5),e.setUint8(5,this.layerid<<3|this.tid),t.set(this.data,6),t}}],[{key:"SLICE_TRAIL_N",get:function(){return 0}},{key:"SLICE_TRAIL_R",get:function(){return 1}},{key:"SLICE_TSA_N",get:function(){return 2}},{key:"SLICE_TLA_R",get:function(){return 3}},{key:"SLICE_STSA_N",get:function(){return 4}},{key:"SLICE_STSA_R",get:function(){return 5}},{key:"SLICE_RADL_N",get:function(){return 6}},{key:"SLICE_RADL_R",get:function(){return 7}},{key:"SLICE_RASL_N",get:function(){return 8}},{key:"SLICE_RASL_R",get:function(){return 9}},{key:"SLICE_BLA_W_LP",get:function(){return 16}},{key:"SLICE_BLA_W_RADL",get:function(){return 17}},{key:"SLICE_BLA_N_LP",get:function(){return 18}},{key:"SLICE_IDR_W_RADL",get:function(){return 19}},{key:"SLICE_IDR_N_LP",get:function(){return 20}},{key:"SLICE_CRA",get:function(){return 21}},{key:"SLICE_RSV_IRAP_VCL22",get:function(){return 22}},{key:"SLICE_RSV_IRAP_VCL23",get:function(){return 23}},{key:"VPS",get:function(){return 32}},{key:"SPS",get:function(){return 33}},{key:"PPS",get:function(){return 34}},{key:"DELIMITER",get:function(){return 35}},{key:"EOS",get:function(){return 36}},{key:"EOB",get:function(){return 37}},{key:"FILTER",get:function(){return 38}},{key:"PREFIX_SEI",get:function(){return 39}},{key:"SUFFIX_SEI",get:function(){return 40}},{key:"STAP",get:function(){return 48}},{key:"FU",get:function(){return 49}},{key:"PACI",get:function(){return 50}},{key:"TYPES",get:function(){var t;return n(n(n(n(n(n(n(n(n(n(t={},e.SLICE_IDR_N_LP,"IDR"),e.SLICE_IDR_W_RADL,"IDR"),e.PREFIX_SEI,"SEI"),e.SUFFIX_SEI,"SEI"),e.VPS,"VPS"),e.SPS,"SPS"),e.PPS,"PPS"),e.SLICE_BLA_W_LP,"RAP"),e.SLICE_BLA_W_RADL,"RAP"),e.SLICE_BLA_N_LP,"RAP"),n(n(n(n(n(n(n(n(n(n(t,e.SLICE_CRA,"RAP"),e.SLICE_RSV_IRAP_VCL22,"RAP"),e.SLICE_RSV_IRAP_VCL23,"RAP"),e.DELIMITER,"AUD"),e.FILTER,"FILTER"),e.EOS,"EOS"),e.EOS,"EOB"),e.SLICE_TRAIL_N,"NDR"),e.SLICE_TRAIL_R,"NDR"),e.SLICE_TSA_N,"NDR"),n(n(n(n(n(n(n(t,e.SLICE_TLA_R,"NDR"),e.SLICE_STSA_N,"NDR"),e.SLICE_STSA_R,"NDR"),e.SLICE_RADL_N,"NDR"),e.SLICE_RADL_R,"NDR"),e.SLICE_RASL_N,"NDR"),e.SLICE_RASL_R,"NDR")}},{key:"type",value:function(t){return t.ntype in e.TYPES?e.TYPES[t.ntype]:"UNKNOWN"}}]),e}();
},{"../utils/binary.js":"gPsu"}],"izR4":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.H265Parser=void 0;var e=require("./exp-golomb.js"),r=require("./nalu-hevc.js");function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function t(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function i(e,r){for(var a=0;a<r.length;a++){var t=r[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,n(t.key),t)}}function s(e,r,a){return r&&i(e.prototype,r),a&&i(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function n(e){var r=o(e,"string");return"symbol"===a(r)?r:String(r)}function o(e,r){if("object"!==a(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,r||"default");if("object"!==a(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}var c=exports.H265Parser=function(){function a(e){t(this,a),this.track=e,this.firstFound=!1}return s(a,[{key:"parseVPS",value:function(e){this.track.vps=[e];var r=a.readVPS(e);this.track.vpsconfig=r,this.track.codec=a.getCodecByConfig(r)}},{key:"parseSPS",value:function(e){var r=a.readSPS(e);this.track.width=r.width,this.track.height=r.height,this.track.hasBFrames=r.hasBFrames,this.track.sps=[e]}},{key:"parsePPS",value:function(e){this.track.pps=[e]}},{key:"parseNAL",value:function(e){if(!e)return!1;var a=null;switch(e.type()){case r.HEVC_NALU.SLICE_RADL_N:case r.HEVC_NALU.SLICE_RADL_R:case r.HEVC_NALU.SLICE_RASL_N:case r.HEVC_NALU.SLICE_STSA_N:case r.HEVC_NALU.SLICE_STSA_R:case r.HEVC_NALU.SLICE_TLA_R:case r.HEVC_NALU.SLICE_TSA_N:case r.HEVC_NALU.SLICE_TRAIL_N:case r.HEVC_NALU.SLICE_TRAIL_R:case r.HEVC_NALU.SLICE_BLA_W_LP:case r.HEVC_NALU.SLICE_BLA_N_LP:case r.HEVC_NALU.SLICE_BLA_W_RADL:case r.HEVC_NALU.SLICE_IDR_N_LP:case r.HEVC_NALU.SLICE_IDR_W_RADL:case r.HEVC_NALU.SLICE_CRA:case r.HEVC_NALU.SLICE_RSV_IRAP_VCL22:case r.HEVC_NALU.SLICE_RSV_IRAP_VCL23:e.isKeyframe()&&!this.firstFound&&(this.firstFound=!0),a=!!this.firstFound;break;case r.HEVC_NALU.VPS:a=!1,this.track.vps||this.parseVPS(e.getData().subarray(4));break;case r.HEVC_NALU.SPS:a=!1,this.track.sps||this.parseSPS(e.getData().subarray(4));break;case r.HEVC_NALU.PPS:a=!1,this.track.pps||this.parsePPS(e.getData().subarray(4));break;case r.HEVC_NALU.PREFIX_SEI:case r.HEVC_NALU.SUFFIX_SEI:a=!1;var t=new DataView(e.data.buffer,e.data.byteOffset,e.data.byteLength),i=0;t.getUint8(i);++i;var s=t.getUint8(i);for(++i;255===s;)s,s=t.getUint8(i),++i;s;e.data.subarray(i,i+16);i+=16;break;case r.HEVC_NALU.EOS:case r.HEVC_NALU.EOB:a=!1}return null===a&&e.getLayerID()>0&&(a=!0),a}}],[{key:"generalProfileSpaceString",value:function(e){var r;switch(e){case 0:r="";break;case 1:r="A";break;case 2:r="B";break;case 3:r="A";break;default:throw Error("Invalid hevc GeneralProfileSpace:".concat(e,"!"))}return r}},{key:"swap32",value:function(e){return(65280&e)<<24|(65280&e)<<8|e>>8&65280|e>>24&255}},{key:"trim_leading_zeros",value:function(e){for(var r=0;r<e.length;++r)if("0"!==e.charCodeAt(r))return e.substr(r);return"0"}},{key:"reverse_bits_and_hex_encode",value:function(e){e=(252645135&(e=(858993459&(e=(1431655765&e)<<1|(2863311530&e)>>>1))<<2|(3435973836&e)>>>2))<<4|(4042322160&e)>>>4;var r=(e=this.swap32(e)).toString(16);return a.trim_leading_zeros(r)}},{key:"getCodecByConfig",value:function(e){var r="hvc1.",t=[];t.push("".concat(a.generalProfileSpaceString(e.GeneralProfileSpace)).concat(e.GeneralProfileIdc)),t.push(a.reverse_bits_and_hex_encode(e.GeneralProfileCompatibilityFlags)),t.push((e.GeneralTierFlag?"H":"L")+e.GeneralLevelIdc);for(var i=e.GeneralConstraintIndicatorFlags,s=new Uint8Array((0xff0000000000&i)>>40,(0xff00000000&i)>>32,(4278190080&i)>>24,(16711680&i)>>16,(65280&i)>>8,255&i),n=s.length;n>0&&0===i[n-1];--n);for(var o=0;o<n;o++)t.push(s[o].toString(16).padStart(2,"0").toUpperCase());return r+=t.join(".")}},{key:"getCodec",value:function(e){var r=a.readVPS(e);return a.getCodecByConfig(r)}},{key:"readVPS",value:function(r){r=e.ExpGolomb.removeH264or5EmulationBytes(r);var a=new e.ExpGolomb(r);a.skipBits(16),a.skipBits(4),a.skipBits(1),a.skipBits(1),a.skipBits(6);var t=a.readBits(3)+1;a.skipBits(1),a.skipBits(16);var i={};i.GeneralProfileSpace=a.readBits(2),i.GeneralTierFlag=a.readBoolean(),i.GeneralProfileIdc=a.readBits(5),i.GeneralProfileCompatibilityFlags=a.readUInt(),i.GeneralConstraintIndicatorFlags=Number(a.readBits(16)<<32|a.readBits(32)),i.GeneralLevelIdc=a.readBits(8);for(var s=a.readBits(1)?0:t-1;s<t;s++)a.skipUEG(),a.skipUEG(),a.skipUEG();for(var n=a.readBits(6),o=a.readUEG()+1,c=1;c<o;c++)for(var l=0;l<=n;l++)a.skipBits(1);if(a.readBits(1)){var u=a.readBits(32),_=a.readBits(32);i.fixedFrameRate=!0,i.frameDuration=u/_}else i.fixedFrameRate=!1,i.frameDuration=0;return i}},{key:"readSPS",value:function(r){r=e.ExpGolomb.removeH264or5EmulationBytes(r);var a=new e.ExpGolomb(r);a.skipBits(16),a.skipBits(4);var t=a.readBits(3);if(a.skipBits(1),a.skipBits(96),t>0){for(var i=new Uint8Array(8),s=new Uint8Array(8),n=0;n<t;++n)i[n]=a.readBits(1),s[n]=a.readBits(1);a.skipBits(2*(8-t));for(var o=0;o<t;++o)i[o]&&a.skipBits(88),s[o]&&a.skipBits(8)}a.skipUEG();var c=a.readUEG(),l=0;3===c&&(l=a.readBits(1));var u=a.readUEG();console.log("pic_width_in_luma_samples:".concat(u));var _=a.readUEG();if(console.log("pic_height_in_luma_samples:".concat(_)),a.readBoolean()){var f=a.readUEG(),p=a.readUEG(),d=a.readUEG(),E=1!==c&&2!==c||0!==l?1:2,v=1===c&&0===l?2:1;u-=E*p+E*f,_-=v*a.readUEG()+v*d}return a.skipUEG(),a.skipUEG(),a.skipUEG(),{width:u,height:_,hasBFrames:1===a.readBits(1)}}}]),a}();
},{"./exp-golomb.js":"oeMZ","./nalu-hevc.js":"fVMu"}],"VpFC":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.H265Remuxer=void 0;var t=require("../utils/logger.js"),e=require("../parsers/h265.js"),r=require("./base-remuxer.js"),n=require("../parsers/nalu-hevc.js");function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=a(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return s=t.done,t},e:function(t){u=!0,o=t},f:function(){try{s||null==r.return||r.return()}finally{if(u)throw o}}}}function a(t,e){if(t){if("string"==typeof t)return s(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(t,e):void 0}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,f(n.key),n)}}function l(t,e,r){return e&&c(t.prototype,e),r&&c(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function f(t){var e=p(t,"string");return"symbol"===i(e)?e:String(e)}function p(t,e){if("object"!==i(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function h(){return(h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=d(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}}).apply(this,arguments)}function d(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=D(t)););return t}function y(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&v(t,e)}function v(t,e){return(v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function m(t){var e=b();return function(){var r,n=D(t);if(e){var i=D(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return g(this,r)}}function g(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return S(t)}function S(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function b(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function D(t){return(D=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var P=(0,t.getTagged)("remuxer:h265"),w=exports.H265Remuxer=function(t){y(a,r.BaseRemuxer);var i=m(a);function a(t){var o,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(u(this,a),(o=i.call(this,t,s)).nextDts=void 0,o.readyToDecode=!1,o.initialized=!1,o.firstDTS=0,o.firstPTS=0,o.lastDTS=void 0,o.lastSampleDuration=0,o.lastDurations=[],o.tsAlign=Math.round(o.timescale/60),o.mp4track={id:r.BaseRemuxer.getTrackID(),type:"video",len:0,fragmented:!0,vps:"",sps:"",pps:"",width:0,height:0,timescale:t,duration:t,samples:[]},o.samples=[],o.lastGopDTS=-99999999999999,o.gop=[],o.firstUnit=!0,o.h265=new e.H265Parser(o.mp4track),c.vps){var l=new Uint8Array(c.vps);(l[0]>>>1&63)===n.HEVC_NALU.VPS?o.setVPS(l):P.warn("bad VPS in SDP!")}if(c.sps){var f=new Uint8Array(c.sps);(f[0]>>>1&63)===n.HEVC_NALU.SPS?o.setSPS(f):P.warn("bad SPS in SDP")}if(c.pps){var p=new Uint8Array(c.pps);(p[0]>>>1&63)===n.HEVC_NALU.PPS?o.setPPS(p):P.warn("bad PPS in SDP")}return o.mp4track.vps&&o.mp4track.sps&&o.mp4track.pps&&(o.readyToDecode=!0),o}return l(a,[{key:"_scaled",value:function(t){return t>>>this.scaleFactor}},{key:"_unscaled",value:function(t){return t<<this.scaleFactor}},{key:"setVPS",value:function(t){this.h265.parseVPS(t)}},{key:"setSPS",value:function(t){this.h265.parseSPS(t)}},{key:"setPPS",value:function(t){this.h265.parsePPS(t)}},{key:"remux",value:function(t){if(this.lastGopDTS<t.dts){if(this.gop.sort(r.BaseRemuxer.dtsSortFunc),this.gop.length>1){var e=r.BaseRemuxer.groupByDts(this.gop);this.gop=Object.values(e).map(function(t){return t.reduce(function(t,e){var r=e.getData();return r.set(new Uint8Array([0,0,0,1])),t.appendData(r),t})})}var n,i=o(this.gop);try{for(i.s();!(n=i.n()).done;){var s=n.value;h(D(a.prototype),"remux",this).call(this,s)&&(this.mp4track.len+=s.getSize())}}catch(u){i.e(u)}finally{i.f()}this.gop=[],this.lastGopDTS=t.dts}this.h265.parseNAL(t)&&this.gop.push(t),!this.readyToDecode&&this.mp4track.vps&&this.mp4track.sps&&this.mp4track.pps&&(this.readyToDecode=!0)}},{key:"getPayload",value:function(){if(!this.getPayloadBase())return null;for(var t,e,n,i,o=new Uint8Array(this.mp4track.len),a=0,s=this.mp4track.samples;this.samples.length;){var u=this.samples.shift();if(null===u){this.nextDts=void 0;break}var c=u.unit;if(n=u.pts-this.initDTS,i=u.dts-this.initDTS,i=Math.min(n,i),void 0!==e){var l=this.scaled(i-e);if(l<0){P.log("invalid HEVC sample duration at PTS/DTS: ".concat(n,"/").concat(i,"|lastDTS: ").concat(e,":").concat(l)),this.mp4track.len-=c.getSize();continue}this.lastDurations.push(l),this.lastDurations.length>100&&this.lastDurations.shift(),t.duration=l}else{if(this.nextDts){var f=i-this.nextDts;if(Math.abs(Math.round(r.BaseRemuxer.toMS(f)))<600)f&&(i=this.nextDts,n=Math.max(n-f,i));else if(f<0){P.log("skip frame from the past at DTS=".concat(i," with expected DTS=").concat(this.nextDts)),this.mp4track.len-=c.getSize();continue}}this.firstDTS=Math.max(0,i)}var p=(t={size:c.getSize(),duration:0,cts:this.scaled(n-i),flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,isNonSync:0}}).flags;!0===u.unit.isKeyframe()?(p.dependsOn=2,p.isDependedOn=1,p.isNonSync=0):(p.dependsOn=1,p.isDependedOn=1,p.isNonSync=1),o.set(c.getData(),a),a+=c.getSize(),s.push(t),e=i}if(!s.length)return null;var h=this.lastDurations.reduce(function(t,e){return(0|t)+(0|e)},0)/(this.lastDurations.length||1)|0;if(s.length>=2?(this.lastSampleDuration=h,t.duration=h):t.duration=this.lastSampleDuration,s.length&&(!this.nextDts||navigator.userAgent.toLowerCase().indexOf("chrome")>-1)){var d=s[0].flags;d.dependsOn=2,d.isNonSync=0}return this.nextDts=i+this.unscaled(this.lastSampleDuration),new Uint8Array(o.buffer,0,this.mp4track.len)}}]),a}();
},{"../utils/logger.js":"xVgw","../parsers/h265.js":"izR4","./base-remuxer.js":"AvRn","../parsers/nalu-hevc.js":"fVMu"}],"y5rR":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Remuxer=void 0;var t=require("../utils/event.js"),e=require("../utils/logger.js"),r=require("../iso-bmff/mp4-generator.js"),n=require("./aac.js"),i=require("./h264.js"),o=require("./h265.js"),a=require("../presentation/mse.js"),s=require("../StreamDefine.js"),c=require("../utils/ASMediaError.js");function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t,e,r){return(e=E(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function h(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=f(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function f(t,e){if(t){if("string"==typeof t)return p(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?p(t,e):void 0}}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function y(){y=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function h(t,e,r,n){var o=e&&e.prototype instanceof k?e:k,a=Object.create(o.prototype),s=new _(n||[]);return i(a,"_invoke",{value:P(t,r,s)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var p="suspendedStart",d="suspendedYield",v="executing",m="completed",g={};function k(){}function E(){}function b(){}var w={};l(w,a,function(){return this});var S=Object.getPrototypeOf,L=S&&S(S(C([])));L&&L!==r&&n.call(L,a)&&(w=L);var x=b.prototype=k.prototype=Object.create(w);function T(t){["next","throw","return"].forEach(function(e){l(t,e,function(t){return this._invoke(e,t)})})}function j(t,e){function r(i,o,a,s){var c=f(t[i],t,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==u(h)&&n.call(h,"__await")?e.resolve(h.__await).then(function(t){r("next",t,a,s)},function(t){r("throw",t,a,s)}):e.resolve(h).then(function(t){l.value=t,a(l)},function(t){return r("throw",t,a,s)})}s(c.arg)}var o;i(this,"_invoke",{value:function(t,n){function i(){return new e(function(e,i){r(t,n,e,i)})}return o=o?o.then(i,i):i()}})}function P(e,r,n){var i=p;return function(o,a){if(i===v)throw new Error("Generator is already running");if(i===m){if("throw"===o)throw a;return{value:t,done:!0}}for(n.method=o,n.arg=a;;){var s=n.delegate;if(s){var c=A(s,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===p)throw i=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=v;var u=f(e,r,n);if("normal"===u.type){if(i=n.done?m:d,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=m,n.method="throw",n.arg=u.arg)}}}function A(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,A(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var o=f(i,e.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,g;var a=o.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function M(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function _(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function C(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return o.next=o}}throw new TypeError(u(e)+" is not iterable")}return E.prototype=b,i(x,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:E,configurable:!0}),E.displayName=l(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===E||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,l(t,c,"GeneratorFunction")),t.prototype=Object.create(x),t},e.awrap=function(t){return{__await:t}},T(j.prototype),l(j.prototype,s,function(){return this}),e.AsyncIterator=j,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var a=new j(h(t,r,n,i),o);return e.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},T(x),l(x,c,"Generator"),l(x,a,function(){return this}),l(x,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=C,_.prototype={constructor:_,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(M),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return s.type="throw",s.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),M(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;M(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:C(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function d(t,e,r,n,i,o,a){try{var s=t[o](a),c=s.value}catch(u){return void r(u)}s.done?e(c):Promise.resolve(c).then(n,i)}function v(t){return function(){var e=this,r=arguments;return new Promise(function(n,i){var o=t.apply(e,r);function a(t){d(o,n,i,a,s,"next",t)}function s(t){d(o,n,i,a,s,"throw",t)}a(void 0)})}}function m(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function g(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,E(n.key),n)}}function k(t,e,r){return e&&g(t.prototype,e),r&&g(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function E(t){var e=b(t,"string");return"symbol"===u(e)?e:String(e)}function b(t,e){if("object"!==u(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var w="remuxer",S=(0,e.getTagged)(w),L=exports.Remuxer=function(){function e(r){m(this,e),this.mse=new a.MSE([r]),this.eventSource=new t.EventEmitter,this.mseEventSource=new t.EventSourceWrapper(this.mse.eventSource),this.mse_ready=!0,this.reset(),this.errorListener=this.mseError.bind(this),this.closeListener=this.mseClose.bind(this),this.errorDecodeListener=this.mseErrorDecode.bind(this),this.eventSource.addEventListener("ready",this.init.bind(this))}return k(e,[{key:"initMSEHandlers",value:function(){this.mseEventSource.on("error",this.errorListener),this.mseEventSource.on("sourceclosed",this.closeListener),this.mseEventSource.on("errordecode",this.errorDecodeListener)}},{key:"reset",value:function(){var t=v(y().mark(function t(){return y().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.tracks={},this.initialized=!1,this.initSegments={},this.codecs=[],this.streams={},this.enabled=!1,t.next=8,this.mse.clear();case 8:this.initMSEHandlers();case 9:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"destroy",value:function(){this.mseEventSource.destroy(),this.mse.destroy(),this.mse=null,this.detachClient(),this.eventSource.destroy()}},{key:"onTracks",value:function(t){var r=this;S.debug("ontracks: ",t.detail),t.detail.forEach(function(t,n,i){r.tracks[t.type]=new e.TrackConverters[t.type](e.TrackTimescale[t.type],e.TrackScaleFactor[t.type],t.params),t.offset&&(r.tracks[t.type].timeOffset=t.offset),t.duration?(r.tracks[t.type].mp4track.duration=t.duration*(r.tracks[t.type].timescale||e.TrackTimescale[t.type]),r.tracks[t.type].duration=t.duration):r.tracks[t.type].duration=1}),this.mse.setLive(!this.client.seekable)}},{key:"setTimeOffset",value:function(t,e){this.tracks[e.type]&&(this.tracks[e.type].timeOffset=t)}},{key:"MSE",get:function(){return this.mse}},{key:"init",value:function(){var t=this,e=[];this.codecs=[];var n=[],i=!0;for(var o in this.tracks){var s=this.tracks[o];if(!a.MSE.isSupported([s.mp4track.codec]))throw new Error("".concat(s.mp4track.type," codec ").concat(s.mp4track.codec," is not supported"));e.push(s.mp4track),this.codecs.push(s.mp4track.codec),s.init(1/0,1/0),"video"===s.mp4track.type&&s.mp4track.vps&&(i=!1)}for(var c in this.tracks){var u=this.tracks[c];this.initSegments[c]=r.MP4.initSegment(i,[u.mp4track],u.duration*u.timescale,u.timescale),n.push(this.initMSE(c,u.mp4track.codec))}return this.initialized=!0,Promise.all(n).then(function(){t.enabled=!0})}},{key:"initMSE",value:function(t,e){var r=this;if(a.MSE.isSupported(this.codecs))return this.mse.setCodec(t,"".concat(s.PayloadType.map[t],'/mp4; codecs="').concat(e,'"')).then(function(){r.mse.feed(t,r.initSegments[t])});this.eventSource.dispatchEvent("error",new c.ASMediaError(c.ASMediaError.MEDIA_ERR_DECODE,"Codecs:".concat(this.codecs," are not supported")))}},{key:"mseError",value:function(t){this.eventSource.dispatchEvent("error",new c.ASMediaError(c.ASMediaError.MEDIA_ERR_DECODE,t))}},{key:"mseClose",value:function(){this.eventSource.dispatchEvent("error",new c.ASMediaError(c.ASMediaError.MEDIA_ERR_DECODE,"mse closed!"))}},{key:"mseErrorDecode",value:function(){this.tracks[2]&&(console.warn(this.tracks[2].mp4track.type),this.mse.buffers[2].destroy(),delete this.tracks[2])}},{key:"flush",value:function(){if(this.onSamples(),this.initialized)for(var t in this.tracks){var e=this.tracks[t],n=e.getPayload();n&&n.byteLength&&(this.mse.feed(t,[r.MP4.moof(e.seq,e.scaled(e.firstDTS),e.mp4track),r.MP4.mdat(n)]),e.flush())}else if(Object.keys(this.tracks).length){for(var i in this.tracks){if(!this.tracks[i].readyToDecode||!this.tracks[i].samples.length)return;S.debug("Init MSE for track ".concat(this.tracks[i].mp4track.type))}this.eventSource.dispatchEvent("ready")}}},{key:"onSamples",value:function(t){for(var e in this.client.sampleQueues)for(var r=this.client.sampleQueues[e];r.length;){var n=r.shift();if(this.tracks[e]){var i,o=h(n.units);try{for(o.s();!(i=o.n()).done;){var a=i.value;this.tracks[e].remux(a)}}catch(s){o.e(s)}finally{o.f()}}}}},{key:"onAudioConfig",value:function(t){this.tracks[t.detail.pay]&&this.tracks[t.detail.pay].setConfig(t.detail.config)}},{key:"attachClient",value:function(e){var r=this;this.detachClient(),this.client=e,this.clientEventSource=new t.EventSourceWrapper(this.client.eventSource),this.clientEventSource.on("samples",this.samplesListener),this.clientEventSource.on("audio_config",this.audioConfigListener),this.clientEventSource.on("tracks",this.onTracks.bind(this)),this.clientEventSource.on("flush",this.flush.bind(this)),this.clientEventSource.on("clear",function(){r.reset(),r.mse.clear().then(function(){r.initMSEHandlers()})})}},{key:"detachClient",value:function(){this.client&&(this.clientEventSource.destroy(),this.client=null)}}],[{key:"TrackConverters",get:function(){return l(l(l({},s.PayloadType.H264,i.H264Remuxer),s.PayloadType.H265,o.H265Remuxer),s.PayloadType.AAC,n.AACRemuxer)}},{key:"TrackScaleFactor",get:function(){return l(l(l({},s.PayloadType.H264,1),s.PayloadType.H265,1),s.PayloadType.AAC,0)}},{key:"TrackTimescale",get:function(){return l(l(l({},s.PayloadType.H264,9e4),s.PayloadType.H265,9e4),s.PayloadType.AAC,0)}}]),e}();
},{"../utils/event.js":"Dnsu","../utils/logger.js":"xVgw","../iso-bmff/mp4-generator.js":"xgs9","./aac.js":"E10R","./h264.js":"bPIX","./h265.js":"VpFC","../presentation/mse.js":"hb8a","../StreamDefine.js":"XyKO","../utils/ASMediaError.js":"yB1D"}],"hHPY":[function(require,module,exports) {
"use strict";function t(r){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(r)}function r(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function o(t,r){for(var o=0;o<r.length;o++){var e=r[o];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,n(e.key),e)}}function e(t,r,e){return r&&o(t.prototype,r),e&&o(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function n(r){var o=l(r,"string");return"symbol"===t(o)?o:String(o)}function l(r,o){if("object"!==t(r)||null===r)return r;var e=r[Symbol.toPrimitive];if(void 0!==e){var n=e.call(r,o||"default");if("object"!==t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===o?String:Number)(r)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Url=void 0;var u=exports.Url=function(){function t(){r(this,t)}return e(t,null,[{key:"parse",value:function(r){var o={},e=decodeURI(r).split(" ");r=e.shift(),o.client=e.join(" ");var n=/^([^:]+):\/\/([^\/]+)(.*)$/.exec(r);if(!n)throw new Error("bad url");o.full=r,o.protocol=n[1],o.urlpath=n[3];var l=o.urlpath.split("/");o.basename=l.pop().split(/\?|#/)[0],o.basepath=l.join("/");var u=n[2].split("@"),i=u[0].split(":"),a=[null,null];return 2===u.length&&(a=u[0].split(":"),i=u[1].split(":")),o.user=a[0],o.pass=a[1],o.host=i[0],o.auth=o.user&&o.pass?"".concat(o.user,":").concat(o.pass):"",o.port=null==i[1]?t.protocolDefaultPort(o.protocol):i[1],o.portDefined=null!=i[1],o.location="".concat(o.host,":").concat(o.port),"unix"===o.protocol&&(o.socket=o.port,o.port=void 0),o}},{key:"full",value:function(t){return"".concat(t.protocol,"://").concat(t.location,"/").concat(t.urlpath)}},{key:"isAbsolute",value:function(t){return/^[^:]+:\/\//.test(t)}},{key:"protocolDefaultPort",value:function(t){switch(t){case"rtsp":return 554;case"http":return 80;case"https":return 443;default:return 0}}}]),t}();
},{}],"pENG":[function(require,module,exports) {
"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,r(i.key),i)}}function i(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function r(e){var n=a(e,"string");return"symbol"===t(n)?n:String(n)}function a(e,n){if("object"!==t(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,n||"default");if("object"!==t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.StateMachine=void 0;var o=function(){function t(n,i){e(this,t),this.stateMachine=i,this.transitions=new Set,this.name=n}return i(t,[{key:"activate",value:function(){return Promise.resolve(null)}},{key:"finishTransition",value:function(){}},{key:"failHandler",value:function(){}},{key:"deactivate",value:function(){return Promise.resolve(null)}}]),t}(),s=exports.StateMachine=function(){function t(){e(this,t),this.storage={},this.currentState=null,this.states=new Map}return i(t,[{key:"addState",value:function(t,e){var n=e.activate,i=e.finishTransition,r=e.deactivate,a=new o(t,this);return n&&(a.activate=n),i&&(a.finishTransition=i),r&&(a.deactivate=r),this.states.set(t,a),this}},{key:"addTransition",value:function(t,e){if(!this.states.has(t))throw ReferenceError("No such state: ".concat(t," while connecting to ").concat(e));if(!this.states.has(e))throw ReferenceError("No such state: ".concat(e," while connecting from ").concat(t));return this.states.get(t).transitions.add(e),this}},{key:"_promisify",value:function(t){var e;try{(e=t).then||(e=Promise.resolve(e))}catch(n){e=Promise.reject(n)}return e}},{key:"transitionTo",value:function(t){var e=this;if(null==this.currentState){var n=this.states.get(t);return this._promisify(n.activate.call(this)).then(function(t){return e.currentState=n,t}).then(n.finishTransition.bind(this)).catch(function(t){throw n.failHandler(),t})}if(this.currentState.name===t)return Promise.resolve();if(this.currentState.transitions.has(t)){var i=this.states.get(t);return this._promisify(this.currentState.deactivate.call(this)).then(i.activate.bind(this)).then(function(t){return e.currentState=i,t}).then(i.finishTransition.bind(this)).catch(function(t){throw i.failHandler(),t})}return Promise.reject("No such transition: ".concat(this.currentState.name," to ").concat(t))}}]),t}();
},{}],"BO87":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SDPParser=void 0;var e=require("../utils/logger.js"),t=require("../StreamDefine.js");function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=i(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}function i(e,t){if(e){if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,u(n.key),n)}}function l(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function u(e){var t=c(e,"string");return"symbol"===r(t)?t:String(t)}function c(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var p=(0,e.getTagged)("parser:sdp"),f=exports.SDPParser=function(){function e(){o(this,e),this.version=-1,this.origin=null,this.sessionName=null,this.timing=null,this.sessionBlock={},this.media={},this.tracks={},this.mediaMap={}}return l(e,[{key:"parse",value:function(t){var r=this;return new Promise(function(i,a){var o,s=t,l=!0,u=r.sessionBlock,c=n(s.split("\n"));try{for(c.s();!(o=c.n()).done;){var f=o.value;if(0!==(f=f.replace(/\r/,"")).length){switch(f.charAt(0)){case"v":if(-1!==r.version)return p.log("Version present multiple times in SDP"),a(),!1;l=l&&r._parseVersion(f);break;case"o":if(null!==r.origin)return p.log("Origin present multiple times in SDP"),a(),!1;l=l&&r._parseOrigin(f);break;case"s":if(null!==r.sessionName)return p.log("Session Name present multiple times in SDP"),a(),!1;l=l&&r._parseSessionName(f);break;case"t":if(null!==r.timing)return p.log("Timing present multiple times in SDP"),a(),!1;l=l&&r._parseTiming(f);break;case"m":null!==u&&r.sessionBlock!==u&&(r.media[u.type]=u),(u={}).rtpmap={},l=l&&r._parseMediaDescription(f,u);break;case"a":l=l&&e._parseAttribute(f,u);break;default:p.log("Ignored unknown SDP directive: "+f)}if(!l)return void a()}}}catch(m){c.e(m)}finally{c.f()}r.media[u.type]=u,l?i():a()})}},{key:"_parseVersion",value:function(e){var t=e.match(/^v=([0-9]+)$/);return t&&t.length?(this.version=t[1],0==this.version||(p.log("Unsupported SDP version:"+this.version),!1)):(p.log("'v=' (Version) formatted incorrectly: "+e),!1)}},{key:"_parseOrigin",value:function(e){var t=e.match(/^o=([^ ]+) (-?[0-9]+) (-?[0-9]+) (IN) (IP4|IP6) ([^ ]+)$/);return t&&t.length?(this.origin={},this.origin.username=t[1],this.origin.sessionid=t[2],this.origin.sessionversion=t[3],this.origin.nettype=t[4],this.origin.addresstype=t[5],this.origin.unicastaddress=t[6],!0):(p.log("'o=' (Origin) formatted incorrectly: "+e),!1)}},{key:"_parseSessionName",value:function(e){var t=e.match(/^s=([^\r\n]+)$/);return t&&t.length?(this.sessionName=t[1],!0):(p.log("'s=' (Session Name) formatted incorrectly: "+e),!1)}},{key:"_parseTiming",value:function(e){var t=e.match(/^t=([0-9]+) ([0-9]+)$/);return t&&t.length?(this.timing={},this.timing.start=t[1],this.timing.stop=t[2],!0):(p.log("'t=' (Timing) formatted incorrectly: "+e),!1)}},{key:"_parseMediaDescription",value:function(e,t){var r=e.match(/^m=([^ ]+) ([^ ]+) ([^ ]+)[ ]/);if(!r||!r.length)return p.log("'m=' (Media) formatted incorrectly: "+e),!1;if(t.type=r[1],!["video","audio","text","application"].includes(t.type))throw new Error("Invalid sdp Media Descriptions:".concat(e));t.port=r[2],t.proto=r[3],t.fmt=e.substr(r[0].length).split(" ").map(function(e,t,r){return parseInt(e,10)});var i,a=n(t.fmt);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.mediaMap[o]=t}}catch(s){a.e(s)}finally{a.f()}return!0}},{key:"getSessionBlock",value:function(){return this.sessionBlock}},{key:"hasMedia",value:function(e){return void 0!==this.media[e]}},{key:"getMediaBlock",value:function(e){return this.media[e]}},{key:"getMediaBlockByPayloadType",value:function(e){return this.mediaMap[e]||null}},{key:"getMediaBlockList",value:function(){var e=[];for(var t in this.media)e.push(t);return e}}],[{key:"_parseAttribute",value:function(e,r){if(null===r)return!0;var i,a=e.indexOf(":");switch(e.substr(0,-1===a?2147483647:a)){case"a=recvonly":case"a=sendrecv":case"a=sendonly":case"a=inactive":r.mode=e.substr("a=".length);break;case"a=range":i=e.match(/^a=range:\s*([a-zA-Z-]+)=([0-9.]+|now)\s*-\s*([0-9.]*)$/),r.range=[Number("now"===i[2]?-1:i[2]),Number(i[3]),i[1]];break;case"a=control":r.control=e.substr("a=control:".length);break;case"a=rtpmap":if(null===(i=e.match(/^a=rtpmap:(\d+) (.*)$/)))return p.log("Could not parse 'rtpmap' of 'a='"),!1;var o=parseInt(i[1],10);r.rtpmap[o]={};var s=i[2].split("/");r.rtpmap[o].name=s[0].toUpperCase(),r.rtpmap[o].clock=s[1],void 0!==s[2]&&(r.rtpmap[o].encparams=s[2]),r.ptype=t.PayloadType.string_map[s[0].toUpperCase()];break;case"a=fmtp":if(0===(i=e.match(/^a=fmtp:(\d+) (.*)$/)).length)return p.log("Could not parse 'fmtp'  of 'a='"),!1;r.fmtp={};var l,u=n(i[2].split(";"));try{for(u.s();!(l=u.n()).done;){var c=l.value,f=c.indexOf("=");r.fmtp[c.substr(0,f).toLowerCase().trim()]=c.substr(f+1).trim()}}catch(m){u.e(m)}finally{u.f()}}return!0}}]),e}();
},{"../utils/logger.js":"xVgw","../StreamDefine.js":"XyKO"}],"QSsm":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RTSPTrackStream=void 0;var t=require("../utils/logger.js"),e=require("./RTSPClient.js"),n=require("../utils/url.js");function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=o(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,l=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return l=t.done,t},e:function(t){a=!0,s=t},f:function(){try{l||null==n.return||n.return()}finally{if(a)throw s}}}}function o(t,e){if(t){if("string"==typeof t)return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(t,e):void 0}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,u(r.key),r)}}function c(t,e,n){return e&&a(t.prototype,e),n&&a(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function u(t){var e=h(t,"string");return"symbol"===r(e)?e:String(e)}function h(t,e){if("object"!==r(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!==r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var v="rtsp:stream",f=(0,t.getTagged)(v),p=exports.RTSPTrackStream=function(){function t(e,n){l(this,t),this.state=null,this.client=e,this.track=n,this.rtpChannel=1,this.stopKeepAlive(),this.keepaliveInterval=null,this.keepaliveTime=3e4}return c(t,[{key:"reset",value:function(){f.debug("reset!!!"),this.stopKeepAlive(),this.client.forgetRTPChannel(this.rtpChannel),this.client=null,this.track=null}},{key:"start",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null!=e?e.then(function(e){return t.sendSetup(e.session)}):this.sendSetup()}},{key:"stop",value:function(){}},{key:"getSetupURL",value:function(t){var e=this.client.sdp.getSessionBlock();return n.Url.isAbsolute(t.control)?t.control:n.Url.isAbsolute("".concat(e.control).concat(t.control))?"".concat(e.control).concat(t.control):n.Url.isAbsolute("".concat(this.client.contentBase).concat(t.control))?"/"!==this.client.contentBase[this.client.contentBase.length-1]?"".concat(this.client.contentBase,"/").concat(t.control):"".concat(this.client.contentBase).concat(t.control):t.control}},{key:"getControlURL",value:function(){var t=this.client.sdp.getSessionBlock().control;return n.Url.isAbsolute(t)?t:t&&"*"!==t?"".concat(this.client.contentBase).concat(t):this.client.contentBase}},{key:"sendKeepalive",value:function(){return this.client.methods.includes("GET_PARAMETER")?this.client.sendRequest("GET_PARAMETER",this.getSetupURL(this.track),{Session:this.session}):this.client.sendRequest("OPTIONS","*")}},{key:"stopKeepAlive",value:function(){clearInterval(this.keepaliveInterval)}},{key:"startKeepAlive",value:function(){var t=this;this.keepaliveInterval=setInterval(function(){t.sendKeepalive().catch(function(t){f.error(t),t instanceof e.RTSPError&&Number(t.data.parsed.code)})},this.keepaliveTime)}},{key:"sendRequest",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={};return this.session&&(n.Session=this.session),Object.assign(n,e),this.client.sendRequest(t,this.getControlURL(),n)}},{key:"sendSetup",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;f.log("send setup"),this.state=e.RTSPClientSM.STATE_SETUP,this.rtpChannel=this.client.interleaveChannelIndex;var r=this.client.interleaveChannelIndex+++"-"+this.client.interleaveChannelIndex++,o={Transport:"RTP/AVP/TCP;unicast;interleaved=".concat(r),Date:(new Date).toUTCString()};return n&&(o.Session=n),this.client.sendRequest("SETUP",this.getSetupURL(this.track),o).then(function(e){t.session=e.headers.session;var n=e.headers.transport;if(n){var r=n.match(/interleaved=([0-9]+)-([0-9]+)/)[1];r&&(t.rtpChannel=Number(r))}var o,s={},l=i(t.session.split(";").slice(1));try{for(l.s();!(o=l.n()).done;){var a=o.value.split("=");s[a[0]]=a[1]}}catch(c){l.e(c)}finally{l.f()}return s.timeout&&(t.keepaliveInterval=500*Number(s.timeout)),f.debug("add rtp channel:".concat(t.rtpChannel)),t.client.useRTPChannel(t.rtpChannel),t.startKeepAlive(),{track:t.track,data:e,session:t.session}})}}]),t}();
},{"../utils/logger.js":"xVgw","./RTSPClient.js":"THfu","../utils/url.js":"hHPY"}],"SoRP":[function(require,module,exports) {
"use strict";function n(n,r){var t=(65535&n)+(65535&r);return(n>>16)+(r>>16)+(t>>16)<<16|65535&t}function r(n,r){return n<<r|n>>>32-r}function t(t,e,u,o,c,f){return n(r(n(n(e,t),n(o,f)),c),u)}function e(n,r,e,u,o,c,f){return t(r&e|~r&u,n,r,o,c,f)}function u(n,r,e,u,o,c,f){return t(r&u|e&~u,n,r,o,c,f)}function o(n,r,e,u,o,c,f){return t(r^e^u,n,r,o,c,f)}function c(n,r,e,u,o,c,f){return t(e^(r|~u),n,r,o,c,f)}function f(r,t){var f,i,a,h,l;r[t>>5]|=128<<t%32,r[14+(t+64>>>9<<4)]=t;var d=1732584193,g=-271733879,v=-1732584194,s=271733878;for(f=0;f<r.length;f+=16)i=d,a=g,h=v,l=s,d=e(d,g,v,s,r[f],7,-680876936),s=e(s,d,g,v,r[f+1],12,-389564586),v=e(v,s,d,g,r[f+2],17,606105819),g=e(g,v,s,d,r[f+3],22,-1044525330),d=e(d,g,v,s,r[f+4],7,-176418897),s=e(s,d,g,v,r[f+5],12,1200080426),v=e(v,s,d,g,r[f+6],17,-1473231341),g=e(g,v,s,d,r[f+7],22,-45705983),d=e(d,g,v,s,r[f+8],7,1770035416),s=e(s,d,g,v,r[f+9],12,-1958414417),v=e(v,s,d,g,r[f+10],17,-42063),g=e(g,v,s,d,r[f+11],22,-1990404162),d=e(d,g,v,s,r[f+12],7,1804603682),s=e(s,d,g,v,r[f+13],12,-40341101),v=e(v,s,d,g,r[f+14],17,-1502002290),d=u(d,g=e(g,v,s,d,r[f+15],22,1236535329),v,s,r[f+1],5,-165796510),s=u(s,d,g,v,r[f+6],9,-1069501632),v=u(v,s,d,g,r[f+11],14,643717713),g=u(g,v,s,d,r[f],20,-373897302),d=u(d,g,v,s,r[f+5],5,-701558691),s=u(s,d,g,v,r[f+10],9,38016083),v=u(v,s,d,g,r[f+15],14,-660478335),g=u(g,v,s,d,r[f+4],20,-405537848),d=u(d,g,v,s,r[f+9],5,568446438),s=u(s,d,g,v,r[f+14],9,-1019803690),v=u(v,s,d,g,r[f+3],14,-187363961),g=u(g,v,s,d,r[f+8],20,1163531501),d=u(d,g,v,s,r[f+13],5,-1444681467),s=u(s,d,g,v,r[f+2],9,-51403784),v=u(v,s,d,g,r[f+7],14,1735328473),d=o(d,g=u(g,v,s,d,r[f+12],20,-1926607734),v,s,r[f+5],4,-378558),s=o(s,d,g,v,r[f+8],11,-2022574463),v=o(v,s,d,g,r[f+11],16,1839030562),g=o(g,v,s,d,r[f+14],23,-35309556),d=o(d,g,v,s,r[f+1],4,-1530992060),s=o(s,d,g,v,r[f+4],11,1272893353),v=o(v,s,d,g,r[f+7],16,-155497632),g=o(g,v,s,d,r[f+10],23,-1094730640),d=o(d,g,v,s,r[f+13],4,681279174),s=o(s,d,g,v,r[f],11,-358537222),v=o(v,s,d,g,r[f+3],16,-722521979),g=o(g,v,s,d,r[f+6],23,76029189),d=o(d,g,v,s,r[f+9],4,-640364487),s=o(s,d,g,v,r[f+12],11,-421815835),v=o(v,s,d,g,r[f+15],16,530742520),d=c(d,g=o(g,v,s,d,r[f+2],23,-995338651),v,s,r[f],6,-198630844),s=c(s,d,g,v,r[f+7],10,1126891415),v=c(v,s,d,g,r[f+14],15,-1416354905),g=c(g,v,s,d,r[f+5],21,-57434055),d=c(d,g,v,s,r[f+12],6,1700485571),s=c(s,d,g,v,r[f+3],10,-1894986606),v=c(v,s,d,g,r[f+10],15,-1051523),g=c(g,v,s,d,r[f+1],21,-2054922799),d=c(d,g,v,s,r[f+8],6,1873313359),s=c(s,d,g,v,r[f+15],10,-30611744),v=c(v,s,d,g,r[f+6],15,-1560198380),g=c(g,v,s,d,r[f+13],21,1309151649),d=c(d,g,v,s,r[f+4],6,-145523070),s=c(s,d,g,v,r[f+11],10,-1120210379),v=c(v,s,d,g,r[f+2],15,718787259),g=c(g,v,s,d,r[f+9],21,-343485551),d=n(d,i),g=n(g,a),v=n(v,h),s=n(s,l);return[d,g,v,s]}function i(n){var r,t="",e=32*n.length;for(r=0;r<e;r+=8)t+=String.fromCharCode(n[r>>5]>>>r%32&255);return t}function a(n){var r,t=[];for(t[(n.length>>2)-1]=void 0,r=0;r<t.length;r+=1)t[r]=0;var e=8*n.length;for(r=0;r<e;r+=8)t[r>>5]|=(255&n.charCodeAt(r/8))<<r%32;return t}function h(n){return i(f(a(n),8*n.length))}function l(n,r){var t,e,u=a(n),o=[],c=[];for(o[15]=c[15]=void 0,u.length>16&&(u=f(u,8*n.length)),t=0;t<16;t+=1)o[t]=909522486^u[t],c[t]=1549556828^u[t];return e=f(o.concat(a(r)),512+8*r.length),i(f(c.concat(e),640))}function d(n){var r,t,e="";for(t=0;t<n.length;t+=1)r=n.charCodeAt(t),e+="0123456789abcdef".charAt(r>>>4&15)+"0123456789abcdef".charAt(15&r);return e}function g(n){return unescape(encodeURIComponent(n))}function v(n){return h(g(n))}function s(n){return d(v(n))}function p(n,r){return l(g(n),g(r))}function C(n,r){return d(p(n,r))}function A(n,r,t){return r?t?p(r,n):C(r,n):t?v(n):s(n)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=A;
},{}],"tzdu":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("../utils/logger.js");function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,s(n.key),n)}}function r(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t){var i=o(t,"string");return"symbol"===e(i)?i:String(i)}function o(t,i){if("object"!==e(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,i||"default");if("object"!==e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}var a=exports.default=function(){function e(n,r){i(this,e);var s=new DataView(n.buffer,n.byteOffset,n.byteLength);this.version=s.getUint8(0)>>>6,this.padding=(32&s.getUint8(0))>>>5,this.has_extension=(16&s.getUint8(0))>>>4,this.csrc=15&s.getUint8(0),this.marker=s.getUint8(1)>>>7,this.pt=127&s.getUint8(1),this.sequence=s.getUint16(2),this.timestamp=s.getUint32(4),this.ssrc=s.getUint32(8),this.csrcs=[];var o=12;this.csrc>0&&(this.csrcs.push(s.getUint32(o)),o+=4),1===this.has_extension&&(this.extension=s.getUint16(o),this.ehl=s.getUint16(o+2),o+=4,this.header_data=n.slice(o,this.ehl),o+=this.ehl),this.headerLength=o;var a=0;this.padding&&(a=s.getUint8(n.byteLength-1)),this.bodyLength=n.byteLength-this.headerLength-a,this.media=r.getMediaBlockByPayloadType(this.pt),null===this.media?t.Log.error("Media description for payload type: ".concat(this.pt," not provided.")):this.type=this.media.ptype,this.data=n.subarray(o)}return r(e,[{key:"getPayload",value:function(){return this.data}},{key:"getTimestamp",value:function(){return this.timestamp}},{key:"toString",value:function(){return"RTP(version:"+this.version+", padding:"+this.padding+", has_extension:"+this.has_extension+", csrc:"+this.csrc+", marker:"+this.marker+", pt:"+this.pt+", sequence:"+this.sequence+", timestamp:"+this.timestamp+", ssrc:"+this.ssrc+")"}},{key:"isVideo",value:function(){return"video"===this.media.type}},{key:"isAudio",value:function(){return"audio"===this.media.type}}]),e}();
},{"../utils/logger.js":"xVgw"}],"iiuU":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=e(require("./rtp.js"));function e(t){return t&&t.__esModule?t:{default:t}}function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=o(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,f=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return u=t.done,t},e:function(t){f=!0,i=t},f:function(){try{u||null==r.return||r.return()}finally{if(f)throw i}}}}function o(t,e){if(t){if("string"==typeof t)return a(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(t,e):void 0}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,l(n.key),n)}}function f(t,e,r){return e&&u(t.prototype,e),r&&u(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function l(t){var e=s(t,"string");return"symbol"===r(e)?e:String(e)}function s(t,e){if("object"!==r(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,e||"default");if("object"!==r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var c=exports.default=function(){function e(t){for(var r in i(this,e),this.tsOffsets={},t.media){var o,a=n(t.media[r].fmt);try{for(a.s();!(o=a.n()).done;){var u=o.value;this.tsOffsets[u]={last:0,overflow:0}}}catch(f){a.e(f)}finally{a.f()}}}return f(e,[{key:"build",value:function(e,r){var n=new t.default(e,r),o=this.tsOffsets[n.pt];return o&&(n.timestamp+=o.overflow,o.last&&Math.abs(n.timestamp-o.last)>2147483647&&(console.log("\nlast ts: ".concat(o.last,"\n\n                            new ts: ").concat(n.timestamp,"\n\n                            new ts adjusted: ").concat(n.timestamp+4294967295,"\n\n                            last overflow: ").concat(o.overflow,"\n\n                            new overflow: ").concat(o.overflow+4294967295,"\n\n                            ")),o.overflow+=4294967295,n.timestamp+=4294967295),o.last=n.timestamp),n}}]),e}();
},{"./rtp.js":"tzdu"}],"A6iu":[function(require,module,exports) {
"use strict";function t(r){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(r)}function r(t,r){return u(t)||i(t,r)||n(t,r)||e()}function e(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function n(t,r){if(t){if("string"==typeof t)return o(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?o(t,r):void 0}}function o(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function i(t,r){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=e){var n,o,i,u,a=[],l=!0,c=!1;try{if(i=(e=e.call(t)).next,0===r){if(Object(e)!==e)return;l=!1}else for(;!(l=(n=i.call(e)).done)&&(a.push(n.value),a.length!==r);l=!0);}catch(t){c=!0,o=t}finally{try{if(!l&&null!=e.return&&(u=e.return(),Object(u)!==u))return}finally{if(c)throw o}}return a}}function u(t){if(Array.isArray(t))return t}function a(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function l(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,s(n.key),n)}}function c(t,r,e){return r&&l(t.prototype,r),e&&l(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(r){var e=f(r,"string");return"symbol"===t(e)?e:String(e)}function f(r,e){if("object"!==t(r)||null===r)return r;var n=r[Symbol.toPrimitive];if(void 0!==n){var o=n.call(r,e||"default");if("object"!==t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(r)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.RTSPMessage=exports.MessageBuilder=void 0;var y=exports.RTSPMessage=function(){function t(r){a(this,t),this.version=r}return c(t,[{key:"build",value:function(t,r){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o="".concat(t," ").concat(r," ").concat(this.version,"\r\n");for(var i in e)o+="".concat(i,": ").concat(e[i],"\r\n");return n&&(o+="Content-Length: ".concat(n.length,"\r\n")),o+="\r\n",n&&(o+=n),o}},{key:"parse",value:function(t){var e=t.split("\r\n"),n={headers:{},body:null,code:0,statusLine:""},o=r(e[0].match(new RegExp("".concat(this.version,"[ ]+([0-9]{3})[ ]+(.*)"))),3);o[0],n.code=o[1],n.statusLine=o[2],n.code=Number(n.code);for(var i=1;e[i];){var u=r(e[i].split(/:(.+)/),2),a=u[0],l=u[1];n.headers[a.toLowerCase()]=l.trim(),i++}return n.body=e.slice(i).join("\n\r"),n}}],[{key:"RTSP_1_0",get:function(){return"RTSP/1.0"}}]),t}(),b=exports.MessageBuilder=new y(y.RTSP_1_0);
},{}],"Qhg3":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MediaAccessunit=void 0;var t=require("./StreamDefine.js");function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=n(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var o=0,i=function(){};return{s:i,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,a=!0,f=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){f=!0,u=t},f:function(){try{a||null==r.return||r.return()}finally{if(f)throw u}}}}function n(t,e){if(t){if("string"==typeof t)return o(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(t,e):void 0}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,f(n.key),n)}}function a(t,e,r){return e&&u(t.prototype,e),r&&u(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function f(t){var r=c(t,"string");return"symbol"===e(r)?r:String(r)}function c(t,r){if("object"!==e(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,r||"default");if("object"!==e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}var l=exports.MediaAccessunit=function(){function e(t,r,n,o){i(this,e),this.ctype=t,this.pts=r,this.dts=n,this.units=o,this.config=null,Object.defineProperties(this,{byteLength:{get:function(){}}})}return a(e,[{key:"isKeyFrame",value:function(){var e=!1;if(this.ctype===t.PayloadType.H264||this.ctype===t.PayloadType.H265){var n,o=r(this.units);try{for(o.s();!(n=o.n()).done;){if(n.value.isKeyframe()){e=!0;break}}}catch(i){o.e(i)}finally{o.f()}}else e=!0;return e}}],[{key:"dtsSortFunc",value:function(t,e){return t.dts-e.dts}},{key:"ptsSortFunc",value:function(t,e){return t.pts-e.pts}}]),e}();
},{"./StreamDefine.js":"XyKO"}],"xE87":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.NALUAsm=void 0;var e=require("../utils/logger.js"),t=require("./nalu.js");function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,u(n.key),n)}}function i(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function u(e){var t=o(e,"string");return"symbol"===r(t)?t:String(t)}function o(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!==r(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var l="asm:avc",f=(0,e.getTagged)(l),s=exports.NALUAsm=function(){function e(){n(this,e),this.fragmented_nalu=null}return i(e,[{key:"parseSingleNALUPacket",value:function(e,r,n,a){return new t.NALU(r.type,r.nri,e.subarray(0),n,a)}},{key:"parseAggregationPacket",value:function(r,n,a,i){var u=new DataView(r.buffer,r.byteOffset,r.byteLength),o=0;t.NALU.STAP_B===n.type&&(u.getUint16(o),o+=2);for(var l=[];o<u.byteLength;){var f=u.getUint16(o);o+=2;var s=e.parseNALHeader(u.getInt8(o));o++;var y=this.parseSingleNALUPacket(r.subarray(o,o+f),s,a,i);null!==y&&l.push(y),o+=f}return l}},{key:"parseFragmentationUnit",value:function(e,r,n,a){var i=new DataView(e.buffer,e.byteOffset,e.byteLength),u=0,o=i.getUint8(u),l=(128&o)>>>7,f=(64&o)>>>6,s=31&o,y=null;u++;return t.NALU.FU_B===r.type&&(i.getUint16(u),u+=2),l&&(this.fragmented_nalu=new t.NALU(s,r.nri,e.subarray(u),n,a)),this.fragmented_nalu&&this.fragmented_nalu.ntype===s&&(l||this.fragmented_nalu.appendData(e.subarray(u)),f)?(y=this.fragmented_nalu,this.fragmented_nalu=null,y):null}},{key:"onNALUFragment",value:function(r,n,a){var i=new DataView(r.buffer,r.byteOffset,r.byteLength),u=e.parseNALHeader(i.getUint8(0)),o=null;if(u.type>0&&u.type<24)o=this.parseSingleNALUPacket(r.subarray(1),u,n,a);else{if(t.NALU.FU_A!==u.type&&t.NALU.FU_B!==u.type)return t.NALU.STAP_A===u.type||t.NALU.STAP_B===u.type?this.parseAggregationPacket(r.subarray(1),u,n,a):(f.warn("Undefined NAL unit, type: "+u.type),null);o=this.parseFragmentationUnit(r.subarray(1),u,n,a)}return o?[o]:null}}],[{key:"parseNALHeader",value:function(e){return{nri:96&e,type:31&e}}}]),e}();
},{"../utils/logger.js":"xVgw","./nalu.js":"lqH2"}],"oqAy":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.NALUAsmHevc=void 0;var e=require("../utils/logger.js"),t=require("./nalu-hevc.js");function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,u(n.key),n)}}function i(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function u(e){var t=o(e,"string");return"symbol"===r(t)?t:String(t)}function o(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!==r(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var l="asm:hevc",f=(0,e.getTagged)(l),s=exports.NALUAsmHevc=function(){function e(){n(this,e),this.fragmented_nalu=null}return i(e,[{key:"parseSingleNALUPacket",value:function(e,r,n,a){return new t.HEVC_NALU(r.type,r.layerid,r.tid,e.subarray(0),n,a)}},{key:"parseAggregationPacket",value:function(t,r,n,a){for(var i=new DataView(t.buffer,t.byteOffset,t.byteLength),u=0,o=[];u<i.byteLength;){var l=i.getUint16(u);u+=2;var f=e.parseNALHeader(i.getUint16(u));u++;var s=this.parseSingleNALUPacket(t.subarray(u,u+l),f,n,a);null!==s&&o.push(s),u+=l}return o}},{key:"parseFragmentationUnit",value:function(e,r,n,a){var i=0,u=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint8(i),o=(128&u)>>>7,l=(64&u)>>>6,f=63&u,s=null;return i++,o&&(this.fragmented_nalu=new t.HEVC_NALU(f,r.layerid,r.tid,e.subarray(i),n,a)),this.fragmented_nalu&&this.fragmented_nalu.ntype===f&&(o||this.fragmented_nalu.appendData(e.subarray(i)),l)?(s=this.fragmented_nalu,this.fragmented_nalu=null,s):null}},{key:"onNALUFragment",value:function(r,n,a){var i=new DataView(r.buffer,r.byteOffset,r.byteLength),u=e.parseNALHeader(i.getUint16(0)),o=null;if(u.type>=1&&u.type<=47)o=this.parseSingleNALUPacket(r.subarray(2),u,n,a);else{if(t.HEVC_NALU.FU!==u.type)return t.HEVC_NALU.STAP===u.type?this.parseAggregationPacket(r.subarray(2),u,n,a):(f.warn("Undefined NAL unit, type: "+u.type),null);o=this.parseFragmentationUnit(r.subarray(2),u,n,a)}return o?[o]:null}}],[{key:"parseNALHeader",value:function(e){return{type:e>>>9&63,layerid:e>>>3&63,tid:7&e}}}]),e}();
},{"../utils/logger.js":"xVgw","./nalu-hevc.js":"fVMu"}],"RdzY":[function(require,module,exports) {
"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,o(n.key),n)}}function n(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function o(e){var r=i(e,"string");return"symbol"===t(r)?r:String(r)}function i(e,r){if("object"!==t(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,r||"default");if("object"!==t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.AudioFrame=void 0;var u=exports.AudioFrame=function(){function t(r,n,o){e(this,t),this.dts=n,this.pts=o||this.dts,this.data=r}return n(t,[{key:"getData",value:function(){return this.data}},{key:"getSize",value:function(){return this.data.byteLength}}]),t}();
},{}],"NgmI":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AACAsm=void 0;var e=require("./audio-frame.js"),t=require("../utils/binary");function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function a(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e){var t=u(e,"string");return"symbol"===r(t)?t:String(t)}function u(e,t){if("object"!==r(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!==r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var m=exports.AACAsm=function(){function r(){i(this,r),this.config=null}return a(r,[{key:"onAACFragment",value:function(r){var i=r.getPayload();if(!r.media)return null;var n=new DataView(i.buffer,i.byteOffset,i.byteLength),a=Number(r.media.fmtp.sizelength||0),o=Number(r.media.fmtp.indexlength||0),u=Number(r.media.fmtp.indexdeltalength||0),m=Number(r.media.fmtp.ctsdeltalength||0),f=Number(r.media.fmtp.dtsdeltalength||0),s=Number(r.media.fmtp.randomaccessindication||0),l=Number(r.media.fmtp.streamstateindication||0),d=Number(r.media.fmtp.auxiliarydatasizelength||0),b=a+Math.max(o,u)+m+f+s+l+d,c=0,y=0,p=9e4*(Math.round(r.getTimestamp()/1024)<<10)/this.config.samplerate;if(0!==b){var v=n.getUint16(0);c=2+(v>>>3)+(7&v?1:0);for(var g=[],h=0,w=new t.BitArray(i.subarray(2+y)),A=0,B=0,N=0;N<v;){var S=w.readBits(a);w.readBits(N?u:o);if(N+=a+(N?u:o),m){w.readBits(1);A=w.readBits(m),N+=m}if(f){w.readBits(1);B=w.readBits(f),N+=m}s&&(w.skipBits(1),N+=1),l&&(w.skipBits(l),N+=l),g.push(new e.AudioFrame(i.subarray(c+h,c+h+S),p+B,p+A)),h+=S}return g}for(var x=i.subarray(c);255===x[y];)++y;return++y,[new e.AudioFrame(i.subarray(c+y),p)]}}]),r}();
},{"./audio-frame.js":"RdzY","../utils/binary":"gPsu"}],"YIGO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PESAsm=void 0;var t=require("../utils/binary.js"),e=require("../utils/logger.js");function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,a(n.key),n)}}function i(t,e,r){return e&&s(t.prototype,e),r&&s(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(t){var e=o(t,"string");return"symbol"===r(e)?e:String(e)}function o(t,e){if("object"!==r(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var s=n.call(t,e||"default");if("object"!==r(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var h="parses:pes",u=(0,e.getTagged)(h),f=exports.PESAsm=function(){function e(t){n(this,e),this.pid=t,this.fragments=[],this.pesLength=0,this.pesPkt=null}return i(e,[{key:"parse",value:function(t){if(!this.extPresent)return null;var e=this.parseExtension(t);e.data=t.subarray(e.offset)}},{key:"parseHeader",value:function(){var t=this.fragments[0],e=(t[0]<<16)+(t[1]<<8)+t[2];if(this.extPresent=![190,191].includes(t[3]),1===e){var r=(t[4]<<8)+t[5];return r?(this.pesLength=r,this.hasLength=!0):(this.hasLength=!1,this.pesPkt=null),!0}return!1}},{key:"parseExtension",value:function(t){var e,r,n;return 192&(e=t[1])?((r=536870912*(14&t[3])+4194304*(255&t[4])+16384*(254&t[5])+128*(255&t[6])+(254&t[7])/2)>4294967295&&(r-=8589934592),64&e?(n=536870912*(14&t[8])+4194304*(255&t[9])+16384*(254&t[10])+128*(255&t[11])+(254&t[12])/2)>4294967295&&(n-=8589934592):n=r,{offset:t[2]+9,pts:r,dts:n}):null}},{key:"feed",value:function(e,r){var n=null;if(r&&this.fragments.length){if(!this.parseHeader())throw new Error("Invalid PES packet");var s=6,i={};this.extPresent&&(s=(i=this.parseExtension(this.fragments[0].subarray(6))).offset),this.pesPkt||(this.pesPkt=new Uint8Array(this.pesLength));for(var a=0;this.pesLength&&this.fragments.length;){var o=this.fragments.shift();if(s){if(o.byteLength<s){s-=o.byteLength;continue}o=o.subarray(s),this.pesLength-=s-(this.hasLength?6:0),s=0}this.pesPkt.set(o,a),a+=o.byteLength,this.pesLength-=o.byteLength}n={data:this.pesPkt.subarray(0,a),pts:i.pts,dts:i.dts}}else this.pesPkt=null;return this.pesLength+=e.byteLength,this.fragments.length&&this.fragments[this.fragments.length-1].byteLength<6?this.fragments[this.fragments.length-1]=(0,t.appendByteArray)(this.fragments[this.fragments.length-1],e):this.fragments.push(e),n}}],[{key:"PTSNormalize",value:function(t,e){var r;if(void 0===e)return t;for(r=e<t?-8589934592:8589934592;Math.abs(t-e)>4294967296;)t+=r;return t}}]),e}();
},{"../utils/binary.js":"gPsu","../utils/logger.js":"xVgw"}],"zQSO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.H26XPES=void 0;var t=require("./nalu-asm.js"),e=require("./nalu-asm-hevc.js"),r=require("../utils/binary.js"),n=require("../StreamDefine.js"),a=require("../MediaAccessunit.js");function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=s(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return i=t.done,t},e:function(t){u=!0,o=t},f:function(){try{i||null==r.return||r.return()}finally{if(u)throw o}}}}function s(t,e){if(t){if("string"==typeof t)return u(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(t,e):void 0}}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,y(n.key),n)}}function c(t,e,r){return e&&f(t.prototype,e),r&&f(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function y(t){var e=p(t,"string");return"symbol"===o(e)?e:String(e)}function p(t,e){if("object"!==o(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var b=exports.H26XPES=function(){function o(r){l(this,o),console.log("Construct H26XPES, pesType:".concat(r)),this.pesType=r,r===n.PESType.H264?this.naluasm=new t.NALUAsm:this.naluasm=new e.NALUAsmHevc,this.lastUnit=null}return c(o,[{key:"parse",value:function(t){for(var e,o,s,u=t.data,l=0,f=u.byteLength,c=0,y=[];l<f;)switch(e=u[l++],c){case 0:0===e&&(c=1);break;case 1:c=0===e?2:0;break;case 2:case 3:if(0===e)c=3;else if(1===e&&l<f){if(s){var p=this.naluasm.onNALUFragment(u.subarray(s,l-c-1),t.dts,t.dts);if(p){var b,m=i(p);try{for(m.s();!(b=m.n()).done;){var v=b.value;y.push(v)}}catch(w){m.e(w)}finally{m.f()}}}else(o=l-c-1)&&this.lastUnit&&(this.lastUnit.data=(0,r.appendByteArray)(this.lastUnit.data.byteLength,u.subarray(0,o)));s=l,c=0}else c=0}if(s){var h=this.naluasm.onNALUFragment(u.subarray(s,f),t.dts,t.pts);if(h){var d,g=i(h);try{for(g.s();!(d=g.n()).done;){var S=d.value;y.push(S)}}catch(w){g.e(w)}finally{g.f()}}}return this.lastUnit=y[y.length-1],new a.MediaAccessunit(27===this.pesType?n.PayloadType.H264:n.PayloadType.H265,t.dts,t.dts,y)}}]),o}();
},{"./nalu-asm.js":"xE87","./nalu-asm-hevc.js":"oqAy","../utils/binary.js":"gPsu","../StreamDefine.js":"XyKO","../MediaAccessunit.js":"Qhg3"}],"toet":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AACParser=void 0;var e=require("../utils/binary.js");function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function t(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function n(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,o(n.key),n)}}function i(e,r,t){return r&&n(e.prototype,r),t&&n(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e){var t=a(e,"string");return"symbol"===r(t)?t:String(t)}function a(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var u=exports.AACParser=function(){function r(){t(this,r)}return i(r,null,[{key:"SampleRates",get:function(){return[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350]}},{key:"parseAudioSpecificConfig",value:function(t){var n,i=(n=t.byteLength?new e.BitArray(t):t).bitpos+8*(n.src.byteOffset+n.bytepos),o=n.readBits(5);this.codec="mp4a.40.".concat(o);var a=n.readBits(4);15===a&&n.skipBits(24);var u=n.readBits(4);return{config:(0,e.bitSlice)(new Uint8Array(n.src.buffer),i,i+16),codec:"mp4a.40.".concat(o),samplerate:r.SampleRates[a],channels:u}}},{key:"parseStreamMuxConfig",value:function(t){var n=new e.BitArray(t);if(!n.readBits(1))return n.skipBits(14),r.parseAudioSpecificConfig(n)}}]),r}();
},{"../utils/binary.js":"gPsu"}],"CQu9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ADTS=void 0;var e=require("../utils/binary.js"),r=require("./aac.js");function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function n(e,r){for(var t=0;t<r.length;t++){var i=r[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,a(i.key),i)}}function o(e,r,t){return r&&n(e.prototype,r),t&&n(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e){var r=s(e,"string");return"symbol"===t(r)?r:String(r)}function s(e,r){if("object"!==t(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,r||"default");if("object"!==t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}var u=exports.ADTS=function(){function t(){i(this,t)}return o(t,null,[{key:"parseHeader",value:function(r){var t=new e.BitArray(r);t.skipBits(15);var i=t.readBits(1);t.skipBits(14);var n=t.readBits(13);t.skipBits(11);var o=t.readBits(2);return i||t.skipBits(16),{size:n-t.bytepos,frameCount:o,offset:t.bytepos}}},{key:"parseHeaderConfig",value:function(t){var i=new e.BitArray(t);i.skipBits(15);var n=i.readBits(1),o=i.readBits(2)+1,a=i.readBits(4);i.skipBits(1);var s=i.readBits(3);i.skipBits(4);var u=i.readBits(13);i.skipBits(11);var f=i.readBits(2);n||i.skipBits(16);var p,c=navigator.userAgent.toLowerCase(),l=4;-1!==c.indexOf("firefox")?a>=6?(o=5,l=4,p=a-3):(o=2,l=2,p=a):-1!==c.indexOf("android")?(o=2,l=2,p=a):(o=5,l=4,a>=6?p=a-3:(1===s&&(o=2,l=2),p=a));var y=new Uint8Array(l);return y[0]=o<<3,y[0]|=(14&a)>>1,y[1]|=(1&a)<<7,y[1]|=s<<3,5===o&&(y[1]|=(14&p)>>1,y[2]=(1&p)<<7,y[2]|=8,y[3]=0),{config:{config:y,codec:"mp4a.40.".concat(o),samplerate:r.AACParser.SampleRates[a],channels:s},size:u-i.bytepos,frameCount:f,offset:i.bytepos}}}]),t}();
},{"../utils/binary.js":"gPsu","./aac.js":"toet"}],"StOP":[function(require,module,exports) {
"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,o(n.key),n)}}function n(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function o(e){var r=i(e,"string");return"symbol"===t(r)?r:String(r)}function i(e,r){if("object"!==t(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,r||"default");if("object"!==t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.AACFrame=void 0;var u=exports.AACFrame=function(){function t(r,n,o){e(this,t),this.dts=n,this.pts=o||this.dts,this.data=r}return n(t,[{key:"getData",value:function(){return this.data}},{key:"getSize",value:function(){return this.data.byteLength}}]),t}();
},{}],"T8lx":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AACPES=void 0;var e=require("../utils/logger.js"),t=require("./adts.js"),r=require("../StreamDefine.js"),n=require("../MediaAccessunit.js"),o=require("./aac_frame.js");function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function c(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function f(e){var t=u(e,"string");return"symbol"===a(t)?t:String(t)}function u(e,t){if("object"!==a(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var l="parses:pes_aac",g=(0,e.getTagged)(l),p=exports.AACPES=function(){function e(t){i(this,e),this.pesType=t,this.aacOverFlow=null,this.lastAacPTS=null,this.track={},this.config=null}return c(e,[{key:"parse",value:function(e){var a,i,s,c,f,u,l,p=e.data,y=e.pts,b=this.aacOverFlow,h=this.lastAacPTS;if(b){var d=new Uint8Array(b.byteLength+p.byteLength);d.set(b,0),d.set(p,b.byteLength),g.debug("append overflowing ".concat(b.byteLength," bytes to beginning of new PES")),p=d}for(s=0,f=p.length;s<f-1&&(255!==p[s]||240!=(240&p[s+1]));s++);if(s&&(s<f-1?(u="PES did not start with ADTS header,offset:".concat(s),l=!1):(u="no ADTS header found in AAC PES",l=!0),g.error(u),l))return;var v=null,m=new n.MediaAccessunit(r.PayloadType.AAC,0,0,[]);if(this.config||(v=t.ADTS.parseHeaderConfig(p.subarray(s)),this.config=v.config,m.config=v.config,v.config=null,g.debug("parsed codec:".concat(this.config.codec,",rate:").concat(this.config.samplerate,",nb channel:").concat(this.config.channels))),i=0,a=9216e4/this.config.samplerate,b&&h){var A=h+a;Math.abs(A-y)>1&&(g.debug("align PTS for overlapping frames by ".concat(Math.round((A-y)/90))),y=A)}for(;s+5<f&&(v||(v=t.ADTS.parseHeader(p.subarray(s))),v.size>0&&s+v.offset+v.size<=f);)for(c=y+i*a,m.pts=c,m.dts=c,m.units.push(new o.AACFrame(p.subarray(s+v.offset,s+v.offset+v.size),c)),s+=v.offset+v.size,i++;s<f-1;s++)if(255===p[s]&&240==(240&p[s+1])){v=null;break}return s<f&&255===p[s]?(b=p.subarray(s,f),g.log("AAC: frame length:".concat(f,", offset:").concat(s,", hdr size:").concat(v.size,", hdr offset:").concat(v.offset," overflow detected:").concat(f-s))):b=null,this.aacOverFlow=b,this.lastAacPTS=c,v=null,m}}]),e}();
},{"../utils/logger.js":"xVgw","./adts.js":"CQu9","../StreamDefine.js":"XyKO","../MediaAccessunit.js":"Qhg3","./aac_frame.js":"StOP"}],"QQW5":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.G7XXPES=void 0;var e=require("./audio-frame.js"),t=require("../StreamDefine.js");function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,i(o.key),o)}}function a(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function i(e){var t=u(e,"string");return"symbol"===r(t)?t:String(t)}function u(e,t){if("object"!==r(e)||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var n=o.call(e,t||"default");if("object"!==r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var y=exports.G7XXPES=function(){function r(e){o(this,r),this.pesType=e,this.lastG7xxPTS=null,this.track={}}return a(r,[{key:"payloadType",value:function(){var e=-1;switch(this.pesType){case 144:e=t.PayloadType.ALAW;break;case 145:e=t.PayloadType.ULAW;break;case 146:e=t.PayloadType.G726;break;case 147:e=t.PayloadType.G723;break;case 153:e=t.PayloadType.G729;break;default:throw new Error("Invalid G7XX pes type:".concat(this.pesType))}return e}},{key:"parse",value:function(r){return{units:[new e.AudioFrame(r.data,r.pts)],type:t.StreamType.AUDIO,pay:this.payloadType(this.pesType)}}}]),r}();
},{"./audio-frame.js":"RdzY","../StreamDefine.js":"XyKO"}],"PScq":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TSParser=void 0;var e=require("../utils/logger.js"),r=require("../utils/binary.js"),t=require("./pes.js"),s=require("./pes_h26x.js"),a=require("./pes_aac.js"),i=require("./pes_g7xx.js"),n=require("../StreamDefine.js"),o=require("../utils/ASMediaError.js");function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,r){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=u(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var s=0,a=function(){};return{s:a,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,n=!0,o=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return n=e.done,e},e:function(e){o=!0,i=e},f:function(){try{n||null==t.return||t.return()}finally{if(o)throw i}}}}function u(e,r){if(e){if("string"==typeof e)return f(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?f(e,r):void 0}}function f(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,s=new Array(r);t<r;t++)s[t]=e[t];return s}function d(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function P(e,r){for(var t=0;t<r.length;t++){var s=r[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,c(s.key),s)}}function l(e,r,t){return r&&P(e.prototype,r),t&&P(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function c(e){var r=S(e,"string");return"symbol"===p(r)?r:String(r)}function S(e,r){if("object"!==p(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var s=t.call(e,r||"default");if("object"!==p(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}var h="parses:ts",T=(0,e.getTagged)(h),E=exports.TSParser=function(){function e(){d(this,e),this.pmtParsed=!1,this.pesParserTypes=new Map,this.pesParserTypes.set(n.PESType.AAC,a.AACPES),this.pesParserTypes.set(n.PESType.H264,s.H26XPES),this.pesParserTypes.set(n.PESType.H265,s.H26XPES),this.pesParserTypes.set(n.PESType.PCMA,i.G7XXPES),this.pesParserTypes.set(n.PESType.PCMU,i.G7XXPES),this.pesParserTypes.set(n.PESType.G722,i.G7XXPES),this.pesParserTypes.set(n.PESType.G723,i.G7XXPES),this.pesParserTypes.set(n.PESType.G726,i.G7XXPES),this.pesParserTypes.set(n.PESType.G729,i.G7XXPES),this.pesParsers=new Map,this.pesAsms={},this.ontracks=null,this.toSkip=0}return l(e,[{key:"reset",value:function(){this.pesParsers.clear(),this.pesAsms={},this.pmtParsed=!1,this.toSkip=0}},{key:"parse",value:function(e){var t=new r.BitArray(e);if(71!==e[0])throw T.error("Invalid ts packet, first byte must be 0x47!"),new o.ASMediaError(o.ASMediaError.MEDIA_ERR_AV,"Invalid ts packet, first byte must be 0x47!");t.skipBits(9);var s=t.readBits(1);t.skipBits(1);var a=t.readBits(13);t.skipBits(2);var i=t.readBits(2);if(t.skipBits(4),2===i||3===i){var n=t.readBits(8);if(this.toSkip=t.skipBits(8*n),t.finished())return null}if(0===i||2===i)return T.warn("No pes buffer!"),null;var p=e.subarray(t.bytepos);if(this.pmtParsed&&this.pesParsers.has(a)){var y=this.pesAsms[a].feed(p,s);if(y)return this.pesParsers.get(a).parse(y)}else if(0===a)this.pmtId=this.parsePAT(p),T.debug("pmtId:".concat(this.pmtId));else{if(a!==this.pmtId)throw T.error("Invalid pid:".concat(a)),new o.ASMediaError(o.ASMediaError.MEDIA_ERR_AV,"Invalid pid:".concat(a));this.parsePMT(p),this.pmtParsed=!0}return null}},{key:"parsePAT",value:function(e){var t=new r.BitArray(e),s=t.readBits(8);return t.skipBits(8*s+83),t.readBits(13)}},{key:"parsePMT",value:function(e){var s=new r.BitArray(e),a=s.readBits(8);s.skipBits(8*a+8),s.skipBits(6);var i=s.readBits(10);s.skipBits(62);var p=s.readBits(10);s.skipBits(8*p);for(var u=new Set,f=i-13-p;f>0;){var d=s.readBits(8);s.skipBits(3);var P=s.readBits(13);s.skipBits(6);var l=s.readBits(10);if(s.skipBits(8*l),[n.PESType.AAC,n.PESType.PCMA,n.PESType.PCMU,n.PESType.G726,n.PESType.G723,n.PESType.G729,n.PESType.H264,n.PESType.H265].includes(d)&&this.pesParserTypes.has(d)&&!this.pesParsers.has(P))switch(this.pesParsers.set(P,new(this.pesParserTypes.get(d))(d)),this.pesAsms[P]=new t.PESAsm(P),d){case n.PESType.AAC:u.add({type:n.PayloadType.AAC,offset:0});break;case n.PESType.PCMA:u.add({type:n.PayloadType.PCMA,offset:0});break;case n.PESType.PCMU:u.add({type:n.PayloadType.PCMU,offset:0});break;case n.PESType.G722:u.add({type:n.PayloadType.G722,offset:0});break;case n.PESType.G723:u.add({type:n.PayloadType.G723,offset:0});break;case n.PESType.G726:u.add({type:n.PayloadType.G726,offset:0});break;case n.PESType.G729:u.add({type:n.PayloadType.G729,offset:0});break;case n.PESType.H264:u.add({type:n.PayloadType.H264,offset:0});break;case n.PESType.H265:u.add({type:n.PayloadType.H265,offset:0});break;default:throw new o.ASMediaError(o.ASMediaError.MEDIA_ERR_AV,"Invalid pes type:".concat(d," not supported!"))}f-=5+l}if(0===u.size)throw new o.ASMediaError(o.ASMediaError.MEDIA_ERR_AV,"Parse PMT, not found track!");var c,S=y(u);try{for(S.s();!(c=S.n()).done;){var h=c.value;h.type===n.PayloadType.H264||h.type===n.PayloadType.H265||h.type===n.PayloadType.AAC?(h.hasCodecConf=!0,h.params={},h.ready=!1):(h.hasCodecConf=!1,h.ready=!0)}}catch(T){S.e(T)}finally{S.f()}this.ontracks&&this.ontracks(u)}}],[{key:"PACKET_LENGTH",get:function(){return 188}}]),e}();
},{"../utils/logger.js":"xVgw","../utils/binary.js":"gPsu","./pes.js":"YIGO","./pes_h26x.js":"zQSO","./pes_aac.js":"T8lx","./pes_g7xx.js":"QQW5","../StreamDefine.js":"XyKO","../utils/ASMediaError.js":"yB1D"}],"gxtX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RTPPayloadParser=void 0;var e=require("../MediaAccessunit.js"),t=require("../parsers/nalu-asm.js"),r=require("../parsers/nalu-asm-hevc.js"),n=require("../parsers/aac-asm.js"),a=require("../parsers/ts.js"),i=require("../StreamDefine.js"),o=require("../utils/event.js"),s=require("../utils/ASMediaError.js"),u=require("../utils/logger.js");function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,f(n.key),n)}}function y(e,t,r){return t&&l(e.prototype,t),r&&l(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function f(e){var t=m(e,"string");return"symbol"===p(t)?t:String(t)}function m(e,t){if("object"!==p(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}function h(e,t){return(h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function v(e){var t=g();return function(){var r,n=T(e);if(t){var a=T(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return b(this,r)}}function b(e,t){if(t&&("object"===p(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return P(e)}function P(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var w=exports.RTPPayloadParser=function(e){d(r,o.TinyEvents);var t=v(r);function r(){var e;return c(this,r),(e=t.call(this)).h264parser=new A,e.h265parser=new j,e.aacparser=new S,e.g7xxparser=new E,e.tsparser=new a.TSParser,e.tsparser.ontracks=function(t){e.emit("tracks",t)},e}return y(r,[{key:"reset",value:function(){this.tsparser.reset()}},{key:"parse",value:function(e){var t=null;if("video"===e.media.type&&e.media.ptype===i.PayloadType.H264)(t=this.h264parser.parse(e))&&this.emit("sample",t);else if("video"===e.media.type&&e.media.ptype===i.PayloadType.H265)(t=this.h265parser.parse(e))&&this.emit("sample",t);else if("video"===e.media.type&&e.media.ptype===i.PayloadType.TS){var r=e.getPayload(),n=0;if(r.byteLength%a.TSParser.PACKET_LENGTH)return void u.Log.error("Invalid rtp ts payload length:".concat(r.ByteLength));for(;n<r.byteLength;)t=this.tsparser.parse(r.subarray(n,n+a.TSParser.PACKET_LENGTH)),n+=a.TSParser.PACKET_LENGTH,t&&this.emit("sample",t)}else if("audio"===e.media.type&&e.media.ptype===i.PayloadType.AAC)(t=this.aacparser.parse(e))&&this.emit("sample",t);else{if("audio"!==e.media.type||e.media.ptype!==i.PayloadType.G711&&e.media.ptype!==i.PayloadType.G722&&e.media.ptype!==i.PayloadType.G723&&e.media.ptype!==i.PayloadType.G726&&e.media.ptype!==i.PayloadType.G729)throw(0,s.ASMediaError)(s.ASMediaError.MEDIA_ERROR_AV,"Not support codec:".concat(i.PayloadType.stringCodec(e.media.ptype)));(t=this.g7xxparser.parse(e))&&this.emit("sample",t)}}}]),r}(),A=function(){function r(){c(this,r),this.naluasm=new t.NALUAsm}return y(r,[{key:"parse",value:function(t){var r=this.naluasm.onNALUFragment(t.getPayload());return r?new e.MediaAccessunit(t.type,t.getTimestamp(),t.getTimestamp(),r):null}}]),r}(),j=function(){function t(){c(this,t),this.naluasm=new r.NALUAsmHevc}return y(t,[{key:"parse",value:function(t){var r=this.naluasm.onNALUFragment(t.getPayload());return r?new e.MediaAccessunit(t.type,t.getTimestamp(),t.getTimestamp(),r):null}}]),t}(),S=function(){function t(){c(this,t),this.scale=1,this.asm=new n.AACAsm}return y(t,[{key:"setConfig",value:function(e){this.asm.config=e}},{key:"parse",value:function(t){var r=this.asm.onAACFragment(t),n=9e4*(Math.round(t.getTimestamp()/1024)<<10)/this.config.samplerate;return new e.MediaAccessunit(t.type,n,n,r)}}]),t}(),E=function(){function t(){c(this,t)}return y(t,[{key:"parse",value:function(t){return new e.MediaAccessunit(t.type,t.getTimestamp(),t.getTimestamp(),t.getPayload())}}]),t}();
},{"../MediaAccessunit.js":"Qhg3","../parsers/nalu-asm.js":"xE87","../parsers/nalu-asm-hevc.js":"oqAy","../parsers/aac-asm.js":"NgmI","../parsers/ts.js":"PScq","../StreamDefine.js":"XyKO","../utils/event.js":"Dnsu","../utils/ASMediaError.js":"yB1D","../utils/logger.js":"xVgw"}],"Fh4Z":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RTSPSession=void 0;var t=require("../utils/logger.js"),e=require("./RTSPClient.js"),r=require("../utils/url.js");function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(){o=function(){return e};var t,e={},r=Object.prototype,i=r.hasOwnProperty,a=Object.defineProperty||function(t,e,r){t[e]=r.value},u="function"==typeof Symbol?Symbol:{},c=u.iterator||"@@iterator",s=u.asyncIterator||"@@asyncIterator",l=u.toStringTag||"@@toStringTag";function f(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,r){return t[e]=r}}function h(t,e,r,n){var o=e&&e.prototype instanceof w?e:w,i=Object.create(o.prototype),u=new A(n||[]);return a(i,"_invoke",{value:k(t,r,u)}),i}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var y="suspendedStart",v="suspendedYield",d="executing",g="completed",m={};function w(){}function b(){}function S(){}var E={};f(E,c,function(){return this});var T=Object.getPrototypeOf,x=T&&T(T(N([])));x&&x!==r&&i.call(x,c)&&(E=x);var L=S.prototype=w.prototype=Object.create(E);function P(t){["next","throw","return"].forEach(function(e){f(t,e,function(t){return this._invoke(e,t)})})}function _(t,e){function r(o,a,u,c){var s=p(t[o],t,a);if("throw"!==s.type){var l=s.arg,f=l.value;return f&&"object"==n(f)&&i.call(f,"__await")?e.resolve(f.__await).then(function(t){r("next",t,u,c)},function(t){r("throw",t,u,c)}):e.resolve(f).then(function(t){l.value=t,u(l)},function(t){return r("throw",t,u,c)})}c(s.arg)}var o;a(this,"_invoke",{value:function(t,n){function i(){return new e(function(e,o){r(t,n,e,o)})}return o=o?o.then(i,i):i()}})}function k(e,r,n){var o=y;return function(i,a){if(o===d)throw new Error("Generator is already running");if(o===g){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var u=n.delegate;if(u){var c=R(u,n);if(c){if(c===m)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===y)throw o=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=p(e,r,n);if("normal"===s.type){if(o=n.done?g:v,s.arg===m)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=g,n.method="throw",n.arg=s.arg)}}}function R(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,R(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=p(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function j(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(j,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[c];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(i.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(n(e)+" is not iterable")}return b.prototype=S,a(L,"constructor",{value:S,configurable:!0}),a(S,"constructor",{value:b,configurable:!0}),b.displayName=f(S,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,S):(t.__proto__=S,f(t,l,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},P(_.prototype),f(_.prototype,s,function(){return this}),e.AsyncIterator=_,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new _(h(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},P(L),f(L,l,"Generator"),f(L,c,function(){return this}),f(L,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(O),!e)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(n,o){return u.type="throw",u.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],u=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),s=i.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),O(r),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),m}},e}function i(t,e,r,n,o,i,a){try{var u=t[i](a),c=u.value}catch(s){return void r(s)}u.done?e(c):Promise.resolve(c).then(n,o)}function a(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var a=t.apply(e,r);function u(t){i(a,n,o,u,c,"next",t)}function c(t){i(a,n,o,u,c,"throw",t)}u(void 0)})}}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,l(n.key),n)}}function s(t,e,r){return e&&c(t.prototype,e),r&&c(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function l(t){var e=f(t,"string");return"symbol"===n(e)?e:String(e)}function f(t,e){if("object"!==n(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,e||"default");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var h="rtsp:session",p=(0,t.getTagged)(h),y=exports.RTSPSession=function(){function t(e,r){u(this,t),this.state=null,this.client=e,this.sessionId=r,this.url=this.getControlURL()}return s(t,[{key:"reset",value:function(){this.client=null}},{key:"start",value:function(){return this.sendPlay()}},{key:"stop",value:function(){return this.sendTeardown()}},{key:"getControlURL",value:function(){var t=this.client.sdp.getSessionBlock().control;return r.Url.isAbsolute(t)?t:t&&"*"!==t?"".concat(this.client.contentBase).concat(t):this.client.contentBase}},{key:"sendRequest",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={};return this.sessionId&&(r.Session=this.sessionId),Object.assign(r,e),this.client.sendRequest(t,this.getControlURL(),r)}},{key:"sendPlay",value:function(){var t=a(o().mark(function t(){var r,n,i,a=arguments;return o().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=a.length>0&&void 0!==a[0]?a[0]:0,this.state=e.RTSPClientSM.STATE_PLAY,(n={}).Range="npt=".concat(r,"-"),t.next=6,this.sendRequest("PLAY",n);case 6:return i=t.sent,this.state=e.RTSPClientSM.STATE_PLAYING,t.abrupt("return",{data:i});case 9:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"sendPause",value:function(){var t=a(o().mark(function t(){return o().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.client.supports("PAUSE")){t.next=2;break}return t.abrupt("return");case 2:return this.state=e.RTSPClientSM.STATE_PAUSE,t.next=5,this.sendRequest("PAUSE");case 5:this.state=e.RTSPClientSM.STATE_PAUSED;case 6:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"sendTeardown",value:function(){var t=a(o().mark(function t(){return o().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state===e.RTSPClientSM.STATE_TEARDOWN){t.next=5;break}return this.state=e.RTSPClientSM.STATE_TEARDOWN,t.next=4,this.sendRequest("TEARDOWN");case 4:p.log("RTSPClient: STATE_TEARDOWN");case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}]),t}();
},{"../utils/logger.js":"xVgw","./RTSPClient.js":"THfu","../utils/url.js":"hHPY"}],"CVmQ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BaseClient=void 0;var t=require("./utils/logger.js"),e=require("./utils/url.js"),r=require("./utils/event.js");function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(){o=function(){return e};var t,e={},r=Object.prototype,i=r.hasOwnProperty,a=Object.defineProperty||function(t,e,r){t[e]=r.value},c="function"==typeof Symbol?Symbol:{},u=c.iterator||"@@iterator",s=c.asyncIterator||"@@asyncIterator",l=c.toStringTag||"@@toStringTag";function f(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,r){return t[e]=r}}function h(t,e,r,n){var o=e&&e.prototype instanceof m?e:m,i=Object.create(o.prototype),c=new T(n||[]);return a(i,"_invoke",{value:P(t,r,c)}),i}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var y="suspendedStart",v="suspendedYield",d="executing",b="completed",g={};function m(){}function w(){}function _(){}var E={};f(E,u,function(){return this});var j=Object.getPrototypeOf,k=j&&j(j(N([])));k&&k!==r&&i.call(k,u)&&(E=k);var x=_.prototype=m.prototype=Object.create(E);function L(t){["next","throw","return"].forEach(function(e){f(t,e,function(t){return this._invoke(e,t)})})}function O(t,e){function r(o,a,c,u){var s=p(t[o],t,a);if("throw"!==s.type){var l=s.arg,f=l.value;return f&&"object"==n(f)&&i.call(f,"__await")?e.resolve(f.__await).then(function(t){r("next",t,c,u)},function(t){r("throw",t,c,u)}):e.resolve(f).then(function(t){l.value=t,c(l)},function(t){return r("throw",t,c,u)})}u(s.arg)}var o;a(this,"_invoke",{value:function(t,n){function i(){return new e(function(e,o){r(t,n,e,o)})}return o=o?o.then(i,i):i()}})}function P(e,r,n){var o=y;return function(i,a){if(o===d)throw new Error("Generator is already running");if(o===b){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=C(c,n);if(u){if(u===g)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===y)throw o=b,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=p(e,r,n);if("normal"===s.type){if(o=n.done?b:v,s.arg===g)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=b,n.method="throw",n.arg=s.arg)}}}function C(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,C(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=p(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function D(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(D,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[u];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(i.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(n(e)+" is not iterable")}return w.prototype=_,a(x,"constructor",{value:_,configurable:!0}),a(_,"constructor",{value:w,configurable:!0}),w.displayName=f(_,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,_):(t.__proto__=_,f(t,l,"GeneratorFunction")),t.prototype=Object.create(x),t},e.awrap=function(t){return{__await:t}},L(O.prototype),f(O.prototype,s,function(){return this}),e.AsyncIterator=O,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new O(h(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},L(x),f(x,l,"Generator"),f(x,u,function(){return this}),f(x,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(S),!e)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],c=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var u=i.call(a,"catchLoc"),s=i.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),S(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;S(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}function i(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(s){return void r(s)}c.done?e(u):Promise.resolve(u).then(n,o)}function a(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var a=t.apply(e,r);function c(t){i(a,n,o,c,u,"next",t)}function u(t){i(a,n,o,c,u,"throw",t)}c(void 0)})}}function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,l(n.key),n)}}function s(t,e,r){return e&&u(t.prototype,e),r&&u(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function l(t){var e=f(t,"string");return"symbol"===n(e)?e:String(e)}function f(t,e){if("object"!==n(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,e||"default");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&p(t,e)}function p(t,e){return(p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function y(t){var e=b();return function(){var r,n=g(t);if(e){var o=g(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return v(this,r)}}function v(t,e){if(e&&("object"===n(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return d(t)}function d(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function b(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var m=exports.BaseClient=function(n){h(u,r.TinyEvents);var i=y(u);function u(t){var e;return c(this,u),(e=i.call(this)).options=t,Object.defineProperties(d(e),{sourceUrl:{value:null,writable:!0},paused:{value:!0,writable:!0},seekable:{value:!1,writable:!0},connected:{value:!1,writable:!0},transport:{value:null,writable:!0},duration:function(){return this._getDuration()}}),e._onControl=function(t){e.connected&&e.onControl(t)},e._onJabber=function(t){e.connected&&e.onJabber(t)},e._onData=function(t){e.connected&&e.onData(t)},e._onConnected=e.onConnected.bind(d(e)),e._onDisconnect=e.onDisconnected.bind(d(e)),e._onData=e.onData.bind(d(e)),e._onControl=e.onControl.bind(d(e)),e._onJabber=e.onJabber.bind(d(e)),e._onError=e.onError.bind(d(e)),e}return s(u,[{key:"destroy",value:function(){var t=a(o().mark(function t(){return o().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.detachTransport(),!this.transport){t.next=5;break}return t.next=4,this.transport.disconnect();case 4:this.transport=null;case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"attachTransport",value:function(t){this.transport&&this.detachTransport(),this.transport=t,t.is_reconnect=this.options.reconnect,this.transport.on("control",this._onControl),this.transport.on("jabber",this._onJabber),this.transport.on("data",this._onData),this.transport.on("connected",this._onConnected),this.transport.on("disconnected",this._onDisconnect),this.transport.on("error",this._onError)}},{key:"detachTransport",value:function(){this.transport&&(this.transport.off("jabber",this._onJabber),this.transport.off("control",this._onData),this.transport.off("data",this._onData),this.transport.off("connected",this._onConnected),this.transport.off("disconnected",this._onDisconnect),this.transport.off("error",this._onError))}},{key:"reset",value:function(){}},{key:"start",value:function(){t.Log.log("Client started"),this.paused=!1}},{key:"pause",value:function(){t.Log.log("Client paused"),this.paused=!1}},{key:"stop",value:function(){t.Log.log("Client stoped")}},{key:"seek",value:function(t){}},{key:"setSource",value:function(t){this.stop(),this.endpoint=e.Url.parse(t),this.sourceUrl=this.endpoint.urlpath}},{key:"onControl",value:function(t){}},{key:"onJabber",value:function(t){}},{key:"onData",value:function(t){}},{key:"onConnected",value:function(){this.seekable||this.emit("clear"),this.connected=!0}},{key:"onDisconnected",value:function(){this.connected=!1}},{key:"onError",value:function(t){this.emit("error",t)}},{key:"queryCredentials",value:function(){return Promise.resolve()}},{key:"setCredentials",value:function(t,e){this.endpoint.user=t,this.endpoint.pass=e,this.endpoint.auth="".concat(t,":").concat(e)}},{key:"_getDuration",value:function(){throw Error("Call _getDuration() in abstract class BaseClient!")}}],[{key:"streamType",value:function(){return null}}]),u}();
},{"./utils/logger.js":"xVgw","./utils/url.js":"hHPY","./utils/event.js":"Dnsu"}],"THfu":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RTSPError=exports.RTSPClientSM=exports.RTSPClient=void 0;var t=require("../utils/logger.js"),e=require("../utils/ASMediaError.js"),r=require("../utils/url.js"),n=require("../utils/statemachine.js"),o=require("./sdp.js"),i=require("./RTSPTrackStream.js"),a=y(require("../utils/md5.js")),s=y(require("./RTPFactory.js")),c=require("./RTSPMessage.js"),u=require("./RTPPayloadParser.js"),l=require("../StreamDefine.js"),f=require("../utils/binary.js"),p=require("../parsers/aac.js"),h=require("./RTSPSession.js"),d=require("../BaseClient.js");function y(t){return t&&t.__esModule?t:{default:t}}function v(t){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function T(t,e){return E(t)||S(t,e)||b(t,e)||m()}function m(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function S(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,s=[],c=!0,u=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(s.push(n.value),s.length!==e);c=!0);}catch(t){u=!0,o=t}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}function E(t){if(Array.isArray(t))return t}function g(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=b(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){s=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}function b(t,e){if(t){if("string"==typeof t)return A(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?A(t,e):void 0}}function A(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function w(t){var e="function"==typeof Map?new Map:void 0;return(w=function(t){if(null===t||!P(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return _(t,arguments,W(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),q(r,t)})(t)}function _(t,e,r){return(_=G()?Reflect.construct.bind():function(t,e,r){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return r&&q(o,r.prototype),o}).apply(null,arguments)}function P(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}function k(){k=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),s=new M(n||[]);return o(a,"_invoke",{value:R(t,r,s)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var p="suspendedStart",h="suspendedYield",d="executing",y="completed",T={};function m(){}function S(){}function E(){}var g={};u(g,a,function(){return this});var b=Object.getPrototypeOf,A=b&&b(b(j([])));A&&A!==r&&n.call(A,a)&&(g=A);var w=E.prototype=m.prototype=Object.create(g);function _(t){["next","throw","return"].forEach(function(e){u(t,e,function(t){return this._invoke(e,t)})})}function P(t,e){function r(o,i,a,s){var c=f(t[o],t,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==v(l)&&n.call(l,"__await")?e.resolve(l.__await).then(function(t){r("next",t,a,s)},function(t){r("throw",t,a,s)}):e.resolve(l).then(function(t){u.value=t,a(u)},function(t){return r("throw",t,a,s)})}s(c.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e(function(e,o){r(t,n,e,o)})}return i=i?i.then(o,o):o()}})}function R(e,r,n){var o=p;return function(i,a){if(o===d)throw new Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=O(s,n);if(c){if(c===T)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:h,u.arg===T)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),T;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,T;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,T):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,T)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function M(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function j(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(v(e)+" is not iterable")}return S.prototype=E,o(w,"constructor",{value:E,configurable:!0}),o(E,"constructor",{value:S,configurable:!0}),S.displayName=u(E,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===S||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,E):(t.__proto__=E,u(t,c,"GeneratorFunction")),t.prototype=Object.create(w),t},e.awrap=function(t){return{__await:t}},_(P.prototype),u(P.prototype,s,function(){return this}),e.AsyncIterator=P,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new P(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},_(w),u(w,c,"Generator"),u(w,a,function(){return this}),u(w,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=j,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,T):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),T},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),I(r),T}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:j(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),T}},e}function R(t,e,r,n,o,i,a){try{var s=t[i](a),c=s.value}catch(u){return void r(u)}s.done?e(c):Promise.resolve(c).then(n,o)}function O(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(t){R(i,n,o,a,s,"next",t)}function s(t){R(i,n,o,a,s,"throw",t)}a(void 0)})}}function x(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function I(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,j(n.key),n)}}function M(t,e,r){return e&&I(t.prototype,e),r&&I(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function j(t){var e=N(t,"string");return"symbol"===v(e)?e:String(e)}function N(t,e){if("object"!==v(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==v(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function L(){return(L="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=D(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}}).apply(this,arguments)}function D(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=W(t)););return t}function C(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&q(t,e)}function q(t,e){return(q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function B(t){var e=G();return function(){var r,n=W(t);if(e){var o=W(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return F(this,r)}}function F(t,e){if(e&&("object"===v(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return U(t)}function U(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function G(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function W(t){return(W=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Y="client:rtsp",z=(0,t.getTagged)(Y),$=exports.RTSPClient=function(t){C(r,d.BaseClient);var e=B(r);function r(t){var n;return x(this,r),(n=e.call(this,t)).clientSM=new K(U(n)),n.clientSM.shouldReconnect=t.reconnect,n}return M(r,[{key:"setSource",value:function(t){L(W(r.prototype),"setSource",this).call(this,t),this.clientSM.setSource(t)}},{key:"attachTransport",value:function(t){L(W(r.prototype),"attachTransport",this).call(this,t),this.clientSM.transport=t}},{key:"detachTransport",value:function(){L(W(r.prototype),"detachTransport",this).call(this),this.clientSM.transport=null}},{key:"reset",value:function(){L(W(r.prototype),"reset",this).call(this),this.clientSM.reset()}},{key:"destroy",value:function(){var t=O(k().mark(function t(){return k().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.clientSM.destroy(),t.next=3,L(W(r.prototype),"destroy",this).call(this);case 3:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"start",value:function(){var t=this;L(W(r.prototype),"start",this).call(this),this.transport?this.connected?Promise.resolve():this.transport.connect().then(function(){return t.connected=!0,t.clientSM.start()}).catch(function(e){t.connected=!1}):Promise.reject("no transport attached")}},{key:"seek",value:function(t){return this.clientSM.start(t)}},{key:"stop",value:function(){return L(W(r.prototype),"stop",this).call(this),this.clientSM.stop()}},{key:"pause",value:function(){return L(W(r.prototype),"pause",this).call(this),this.clientSM.pause()}},{key:"onControl",value:function(t){this.clientSM.onControl(t)}},{key:"onData",value:function(t){this.clientSM.onData(t)}},{key:"onConnected",value:function(){L(W(r.prototype),"onConnected",this).call(this),this.clientSM.onConnected()}},{key:"onDisconnected",value:function(){L(W(r.prototype),"onDisconnected",this).call(this),this.clientSM.onDisconnected(),this.emit("disconnect")}},{key:"_getDuration",value:function(){var t=NaN;if(this.clientSM.sdp){var e=this.clientSM.sdp.timing;e&&"now"!==e.stop&&(t=Number(e.stop)-Number(e.start))}return t}}],[{key:"streamType",value:function(){return"rtsp"}}]),r}(),H=function(t){C(r,w(Error));var e=B(r);function r(t){return x(this,r),e.call(this,t)}return M(r)}(),J=exports.RTSPError=function(t){C(r,w(Error));var e=B(r);function r(t){var n;return x(this,r),(n=e.call(this,t.msg)).data=t,n}return M(r)}(),K=exports.RTSPClientSM=function(t){C(y,n.StateMachine);var d=B(y);function y(t){var e;return x(this,y),(e=d.call(this)).parent=t,e.transport=null,e.payParser=new u.RTPPayloadParser,e.rtp_channels=new Set,e.sessions={},e.promises={},e.payParser.on("tracks",function(t){e.parent.emit("tstracks",t)}),e.payParser.on("sample",function(t){e.parent.emit("sample",t)}),e.addState(y.STATE_INITIAL,{}).addState(y.STATE_OPTIONS,{activate:e.sendOptions,finishTransition:e.onOptions}).addState(y.STATE_DESCRIBE,{activate:e.sendDescribe,finishTransition:e.onDescribe}).addState(y.STATE_SETUP,{activate:e.sendSetup,finishTransition:e.onSetup}).addState(y.STATE_STREAMS,{}).addState(y.STATE_TEARDOWN,{activate:function(){e.started=!1},finishTransition:function(){return e.transitionTo(y.STATE_INITIAL)}}).addTransition(y.STATE_INITIAL,y.STATE_OPTIONS).addTransition(y.STATE_INITIAL,y.STATE_TEARDOWN).addTransition(y.STATE_OPTIONS,y.STATE_DESCRIBE).addTransition(y.STATE_DESCRIBE,y.STATE_SETUP).addTransition(y.STATE_SETUP,y.STATE_STREAMS).addTransition(y.STATE_TEARDOWN,y.STATE_INITIAL).addTransition(y.STATE_STREAMS,y.STATE_TEARDOWN).addTransition(y.STATE_SETUP,y.STATE_TEARDOWN).addTransition(y.STATE_DESCRIBE,y.STATE_TEARDOWN).addTransition(y.STATE_OPTIONS,y.STATE_TEARDOWN),e.reset(),e.shouldReconnect=!1,e}return M(y,[{key:"destroy",value:function(){this.parent=null}},{key:"setSource",value:function(t){this.reset(),this.endpoint=r.Url.parse(t),this.url="".concat(this.endpoint.protocol,"://").concat(this.endpoint.location).concat(this.endpoint.urlpath)}},{key:"onConnected",value:function(){var t=this;this.rtpFactory&&(this.rtpFactory=null),this.shouldReconnect&&this.start().catch(function(e){z.error("onConnected:".concat(e)),t.reset()})}},{key:"onDisconnected",value:function(){var t=O(k().mark(function t(){return k().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.reset(),this.shouldReconnect=!0,t.next=4,this.transitionTo(y.STATE_TEARDOWN);case 4:return t.next=6,this.transitionTo(y.STATE_INITIAL);case 6:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"start",value:function(t){if(this.currentState.name!==y.STATE_STREAMS)return this.transitionTo(y.STATE_OPTIONS);var e=[];for(var r in this.sessions)e.push(this.sessions[r].sendPlay(t));return Promise.all(e)}},{key:"onControl",value:function(t){var r=this.parse(t);z.log(r);var n=r.headers.cseq;n?(this.promises[Number(n)].resovle(r),delete this.promises[Number(n)]):this.promises[Number(n)].reject(new e.ASMediaError(e.ASMediaError.MEDIA_ERROR_RTSP,{code:513,statusLine:"Not found CSeq in RTSP response header!"}))}},{key:"onData",value:function(t){var r=t[1];this.rtp_channels.has(r)?this.onRTP({packet:t.subarray(4),type:r}):(z.error("Not found RTSP channel:".concat(r,"!")),this.parent.emit("error",new e.ASMediaError(e.ASMediaError.MEDIA_ERR_RTSP,{code:512,statusLine:"Not found RTSP channel:".concat(r,"!")})))}},{key:"stop",value:function(){this.shouldReconnect=!1;var t=[];for(var e in this.sessions)t.push(this.sessions[e].stop());return Promise.all(t)}},{key:"pause",value:function(){var t=[];for(var e in this.sessions)t.push(this.sessions[e].sendPause());return Promise.all(t)}},{key:"reset",value:function(){var t=O(k().mark(function t(){var e,r;return k().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(e in this.authenticator="",this.methods=[],this.tracks=[],this.rtpBuffer={},this.payParser.reset(),this.streams)this.streams[e].reset();for(r in this.sessions)this.sessions[r].reset();if(this.streams={},this.sessions={},this.contentBase="",!this.currentState){t.next=19;break}if(this.currentState.name===y.STATE_INITIAL){t.next=17;break}return t.next=14,this.transitionTo(y.STATE_TEARDOWN);case 14:return z.debug("Current state:".concat(this.currentState.name)),t.next=17,this.transitionTo(y.STATE_INITIAL);case 17:t.next=21;break;case 19:return t.next=21,this.transitionTo(y.STATE_INITIAL);case 21:this.sdp=null,this.interleaveChannelIndex=0,this.session=null,this.timeOffset={},this.lastTimestamp={};case 26:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"reconnect",value:function(){var t=O(k().mark(function t(){return k().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.reset();case 2:if(this.currentState.name===y.STATE_INITIAL){t.next=8;break}return t.next=5,this.transitionTo(y.STATE_TEARDOWN);case 5:case 8:return t.abrupt("return",this.transitionTo(y.STATE_OPTIONS));case 9:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"supports",value:function(t){return this.methods.includes(t)}},{key:"parse",value:function(t){z.debug(t);var e=t.split("\r\n\r\n"),r=c.MessageBuilder.parse(e[0]);if(Number(r.headers["content-length"])){var n=t.split("\r\n\r\n");r.body=n[1]}else r.body="";return r}},{key:"sendRequest",value:function(t,e){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return this.cSeq++,Object.assign(n,{CSeq:this.cSeq,"User-Agent":y.USER_AGENT}),this.authenticator&&(n.Authorization=this.authenticator(t)),this.send(c.MessageBuilder.build(t,e,n,o),t).catch(function(i){if(i instanceof H&&!n.Authorization)return r.sendRequest(t,e,n,o);throw i})}},{key:"_transportRequest",value:function(t){var r=this;return new Promise(function(n,o){r.promises[r.cSeq]={resovle:n,reject:o},r.transport.send(t).then(function(){z.log("send data success,cseq:".concat(r.cSeq))}).catch(function(t){delete r.promises[r.cSeq],o(new e.ASMediaError(e.ASMediaError.MEDIA_ERR_RTSP,{code:462,statusLine:"462 Destination Unreachable"}))})})}},{key:"send",value:function(){var t=O(k().mark(function t(r,n){var o,i,s,c,u,l,f,p,h,d,y,v,m,S,E=this;return k().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.transport){t.next=37;break}return t.prev=1,t.next=4,this.transport.ready;case 4:t.next=10;break;case 6:throw t.prev=6,t.t0=t.catch(1),this.onDisconnected(),t.t0;case 10:return z.debug(r),t.next=13,this._transportRequest(r);case 13:if(401!==(o=t.sent).code){t.next=32;break}if(z.debug(o.headers["www-authenticate"]),i=o.headers["www-authenticate"],s=i.substring(0,i.indexOf(" ")),i=i.substr(s.length+1),c=i.split(","),(u=this.parent.endpoint).user&&u.pass){t.next=30;break}return t.prev=22,t.next=25,this.parent.queryCredentials.call(this.parent);case 25:t.next=30;break;case 27:throw t.prev=27,t.t1=t.catch(22),new H(t.t1.message);case 30:if("digest"===s.toLowerCase()){l={},f=g(c);try{for(f.s();!(p=f.n()).done;)h=p.value,d=h.trim(),y=d.split("="),v=T(y,2),m=v[0],S=v[1],l[m]=S.substr(1,S.length-2)}catch(n){f.e(n)}finally{f.f()}this.authenticator=function(t){var e=E.parent.endpoint,r=(0,a.default)("".concat(e.user,":").concat(l.realm,":").concat(e.pass)),n=(0,a.default)("".concat(t,":").concat(E.url)),o=(0,a.default)("".concat(r,":").concat(l.nonce,":").concat(n));return'Digest username="'.concat(e.user,'", realm="').concat(l.realm,'", nonce="').concat(l.nonce,'", uri="').concat(E.url,'", response="').concat(o,'"').concat("")}}else this.authenticator=function(){return"Basic ".concat(btoa(E.parent.endpoint.auth))};throw new H(o);case 32:if(!(o.code>=300)){t.next=34;break}throw new e.ASMediaError(e.ASMediaError.MEDIA_ERR_RTSP,{code:o.code,statusLine:o.statusLine});case 34:return t.abrupt("return",o);case 37:return t.abrupt("return",Promise.reject("No transport attached"));case 38:case"end":return t.stop()}},t,this,[[1,6],[22,27]])}));return function(e,r){return t.apply(this,arguments)}}()},{key:"sendOptions",value:function(){return this.reset(),this.started=!0,this.cSeq=0,this.sendRequest("OPTIONS","*",{})}},{key:"onOptions",value:function(t){return this.methods=t.headers.public.split(",").map(function(t){return t.trim()}),this.transitionTo(y.STATE_DESCRIBE)}},{key:"sendDescribe",value:function(){var t=this;return this.sendRequest("DESCRIBE",this.url,{Accept:"application/sdp"}).then(function(r){return t.sdp=new o.SDPParser,t.sdp.parse(r.body).catch(function(){throw new e.ASMediaError(e.ASMediaError.MEDIA_ERR_RTSP,{code:515,statusLine:"Failed to parse SDP"})}).then(function(){return r})})}},{key:"useRTPChannel",value:function(t){this.rtp_channels.add(t)}},{key:"forgetRTPChannel",value:function(t){this.rtp_channels.delete(t)}},{key:"onDescribe",value:function(t){var r=this;if(z.debug("onDescribe"),this.contentBase=t.headers["content-base"]||this.url,this.tracks=this.sdp.getMediaBlockList(),this.rtpFactory=new s.default(this.sdp),z.log("SDP contained "+this.tracks.length+" track(s). Calling SETUP for each."),t.headers.session&&(this.session=t.headers.session),this.tracks.length)return this.transitionTo(y.STATE_SETUP).catch(function(t){z.error(t),r.parent.emit("error",t)});this.emit("error",new e.ASMediaError(e.ASMediaError.MEDIA_ERR_RTSP,{code:514,statusLine:"No tracks in SDP"}))}},{key:"sendSetup",value:function(){var t=this,e=[],r=null;z.log(this.sdp);var n,o=g(this.tracks);try{for(o.s();!(n=o.n()).done;){var a=n.value;z.log("setup track: "+a);var s=this.sdp.getMediaBlock(a);if(z.log(s),l.PayloadType.string_map[s.rtpmap[s.fmt[0]].name]){this.streams[a]=new i.RTSPTrackStream(this,s);var c=this.streams[a].start(r);r=c,this.rtpBuffer[s.fmt[0]]=[],e.push(c.then(function(e){var r=e.track,n=e.data;z.log(r),t.timeOffset[r.fmt[0]]=0;try{var o,i=g(n.headers["rtp-info"].split(";"));try{for(i.s();!(o=i.n()).done;){var a=T(o.value.split("="),2),s=a[0];a[1];"rtptime"===s&&(t.timeOffset[r.fmt[0]]=0)}}catch(m){i.e(m)}finally{i.f()}}catch(S){}var c={timescale:0,scaleFactor:0};if(r.fmtp&&r.fmtp["sprop-parameter-sets"]){var u=r.fmtp["sprop-parameter-sets"].split(",");c={sps:(0,f.base64ToArrayBuffer)(u[0]),pps:(0,f.base64ToArrayBuffer)(u[1])}}else if(r.fmtp&&r.fmtp["sprop-vps"])c.vps=(0,f.base64ToArrayBuffer)(r.fmtp["sprop-vps"]);else if(r.fmtp&&r.fmtp["sprop-sps"])c.sps=(0,f.base64ToArrayBuffer)(r.fmtp["sprop-sps"]);else if(r.fmtp&&r.fmtp["sprop-pps"])c.pps=(0,f.base64ToArrayBuffer)(r.fmtp["sprop-pps"]);else if(r.fmtp&&r.fmtp.config){var d=r.fmtp.config;t.has_config="0"!=r.fmtp.cpresent,"MPEG4-GENERIC"==r.rtpmap[r.fmt[0]].name?(c={config:p.AACParser.parseAudioSpecificConfig((0,f.hexToByteArray)(d))},t.payParser.aacparser.setConfig(c.config)):d&&(c={config:p.AACParser.parseStreamMuxConfig((0,f.hexToByteArray)(d))},t.payParser.aacparser.setConfig(c.config))}c.duration=t.sdp.sessionBlock.range?t.sdp.sessionBlock.range[1]-t.sdp.sessionBlock.range[0]:1,t.parent.seekable=c.duration>1;var y={track:r,offset:t.timeOffset[r.fmt[0]],type:l.PayloadType.string_map[r.rtpmap[r.fmt[0]].name],params:c,duration:c.duration},v=n.headers.session.split(";")[0];return t.sessions[v]||(t.sessions[v]=new h.RTSPSession(t,v)),y}))}}}catch(u){o.e(u)}finally{o.f()}return Promise.all(e).then(function(e){var r=[];for(var n in t.sessions)r.push(t.sessions[n].start());return Promise.all(r).then(function(){t.parent.emit("tracks",e)})})}},{key:"onSetup",value:function(){return z.debug("onSetup"),this.transitionTo(y.STATE_STREAMS)}},{key:"onRTP",value:function(t){if(this.rtpFactory){var e=this.rtpFactory.build(t.packet,this.sdp);if(e.type)if(void 0!==this.timeOffset[e.pt]){void 0===this.lastTimestamp[e.pt]&&(this.lastTimestamp[e.pt]=e.timestamp-this.timeOffset[e.pt]);var r=this.rtpBuffer[e.pt];for(r.push(e);r.length;){var n=r.shift();if(n.timestamp=n.timestamp-this.timeOffset[n.pt]-this.lastTimestamp[n.pt],n.media)try{this.payParser.parse(n)}catch(o){this.parent.emit("error",o)}}}else this.rtpBuffer[e.pt].push(e)}}}],[{key:"USER_AGENT",get:function(){return"SFRtsp 0.3"}},{key:"STATE_INITIAL",get:function(){return 1}},{key:"STATE_OPTIONS",get:function(){return 2}},{key:"STATE_DESCRIBE",get:function(){return 4}},{key:"STATE_SETUP",get:function(){return 8}},{key:"STATE_STREAMS",get:function(){return 16}},{key:"STATE_TEARDOWN",get:function(){return 32}},{key:"STATE_PLAY",get:function(){return 64}},{key:"STATE_PLAYING",get:function(){return 128}},{key:"STATE_PAUSE",get:function(){return 256}},{key:"STATE_PAUSED",get:function(){return 512}}]),y}();
},{"../utils/logger.js":"xVgw","../utils/ASMediaError.js":"yB1D","../utils/url.js":"hHPY","../utils/statemachine.js":"pENG","./sdp.js":"BO87","./RTSPTrackStream.js":"QSsm","../utils/md5.js":"SoRP","./RTPFactory.js":"iiuU","./RTSPMessage.js":"A6iu","./RTPPayloadParser.js":"gxtX","../StreamDefine.js":"XyKO","../utils/binary.js":"gPsu","../parsers/aac.js":"toet","./RTSPSession.js":"Fh4Z","../BaseClient.js":"CVmQ"}],"fNQe":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.WebsocketTransport=void 0;var e=require("./utils/logger.js"),t=require("./utils/event.js"),n=require("./utils/ASMediaError.js");function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function c(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e){var t=a(e,"string");return"symbol"===r(t)?t:String(t)}function a(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!==r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function f(e){var t=y();return function(){var n,r=v(e);if(t){var o=v(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return d(this,n)}}function d(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return p(e)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var b="transport:ws",h=(0,e.getTagged)(b),m=exports.WebsocketTransport=function(e){u(s,t.TinyEvents);var i=f(s);function s(e,t,n){var r;return o(this,s),(r=i.call(this)).stream_type=n,r.socket_url=e,r.protocols=t,r.attempts=1,r.timeoutID=0,r.is_reconnect=!1,Object.defineProperties(p(r),{readyState:{get:function(){return this.ws.readyState}}}),r.connectPromise=null,r}return c(s,[{key:"_setupWebsocket",value:function(e){e.onopen=this.onOpen.bind(this),e.onerror=this.onError.bind(this),e.onclose=this.onClose.bind(this),e.onmessage=this.onMessage.bind(this)}},{key:"_generateInterval",value:function(e){return 1e3*Math.min(30,Math.pow(2,e)-1)}},{key:"onOpen",value:function(e){h.log("WS connect ".concat(this.socket_url," success!")),this.connectPromise?(this.connectPromise.resolve(),this.connectPromise=null):this.emit("connected")}},{key:"onError",value:function(e){h.log("WS onerror:".concat(e))}},{key:"onClose",value:function(e){h.log("WS onclose, code:".concat(e.code));var t=new n.ASMediaError(n.ASMediaError.MEDIA_ERR_NETWORK,"network disconnected!");this.connectPromise?(this.connectPromise.reject(t),this.connectPromise=null):this.emit("disconnected",t),1e3!==e.code&&4e3!==e.code&&4001!==e.code&&4002!==e.code&&4003!==e.code&&this.is_reconnect&&this.reconnect()}},{key:"onMessage",value:function(e){var t=this;if("string"==typeof e.data)this.emit("control",e.data);else if("object"===r(e.data)){var n=Object.prototype.toString.call(e.data).slice(8,-1);if("ArrayBuffer"===n)36===new DataView(e.data).getUint8(0)?this.emit("data",e.data):this.emit("jabber",e.data);else"Blob"===n?e.data.arrayBuffer().then(function(e){var n=new Uint8Array(e);36===n[0]?t.emit("data",n):t.emit("jabber",n)}):h.log("WS receive invalid data type:".concat(n))}else h.log("WS receive invalid data type!")}},{key:"reconnect",value:function(){var e=this;h.log("WebSocket reconnect...");var t=this._generateInterval(this.attempts);this.timeoutID=setTimeout(function(){e.attempts=e.attempts+1;var t=e.protocols.split(",");e.ws=new WebSocket(e.socket_url,t),e._setupWebsocket(e.ws)},t)}},{key:"connect",value:function(){var e=this;return new Promise(function(t,n){e.connectPromise={resolve:t,reject:n},e.disconnect().then(function(){var t=e.protocols.split(",");e.ws=new WebSocket(e.socket_url,t),e._setupWebsocket(e.ws)})})}},{key:"disconnect",value:function(){var e=this;return new Promise(function(t){e.ws?(e.ws.onclose=function(e){h.log("closed, code:".concat(e.code,".")),t()},e.ws.close()):t()})}},{key:"send",value:function(e){var t=this;return new Promise(function(r,o){var i=t.ws;i.readyState!==WebSocket.OPEN&&(h.error("WS send in invalid state!"),o(new n.ASMediaError(n.ASMediaError.MEDIA_ERR_NETWORK,"WS send in invalid state!"))),i.send(e);var c=setInterval(function(){i.readyState!==WebSocket.OPEN?(clearInterval(c),o(new n.ASMediaError(n.ASMediaError.MEDIA_ERR_NETWORK,"WS send in invalid state!"))):0===i.bufferedAmount&&(clearInterval(c),r())},20)})}}],[{key:"canTransfer",value:function(e){return s.streamTypes().includes(e)}},{key:"streamTypes",value:function(){return["rtsp"]}}]),s}();
},{"./utils/logger.js":"xVgw","./utils/event.js":"Dnsu","./utils/ASMediaError.js":"yB1D"}],"Kb8d":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("../utils/logger.js"),t=require("../utils/ASMediaError.js"),r=f(require("../BaseStream.js")),a=require("../StreamDefine.js"),n=require("../remuxer/remuxer.js"),s=require("../presentation/mse.js"),i=require("./RTSPClient"),o=require("../websocket"),c=require("../parsers/h264.js"),u=require("../parsers/h265.js"),l=require("../parsers/nalu.js"),p=require("../parsers/nalu-hevc.js");function f(e){return e&&e.__esModule?e:{default:e}}function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=h(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==r.return||r.return()}finally{if(o)throw s}}}}function h(e,t){if(e){if("string"==typeof e)return v(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?v(e,t):void 0}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function k(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,S(a.key),a)}}function b(e,t,r){return t&&k(e.prototype,t),r&&k(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function S(e){var t=P(e,"string");return"symbol"===y(t)?t:String(t)}function P(e,t){if("object"!==y(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!==y(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&T(e,t)}function T(e,t){return(T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _(e){var t=C();return function(){var r,a=R(e);if(t){var n=R(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return E(this,r)}}function E(e,t){if(t&&("object"===y(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return A(e)}function A(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function C(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var w="RTSPStream",j=(0,e.getTagged)(w),M=exports.default=function(e){g(y,r.default);var f=_(y);function y(e){var t;m(this,y),(t=f.call(this,e)).firstRAP=!1,t.tracks=null,t.useMSE=!1,t.remux=null,t.isContainer=!1,t.tracksReady=!1,t.sampleQueues={},t._onTracks=t.onTracks.bind(A(t)),t._onTsTracks=t.onTsTracks.bind(A(t)),t._onSample=t.onSample.bind(A(t)),t._onClear=t.onClear.bind(A(t)),t._onDisconnect=t.onDisconnect.bind(A(t)),t._onError=t.onError.bind(A(t)),t.client=new i.RTSPClient(e);var r=new o.WebsocketTransport(t.wsurl,"rtsp","rtsp");return t.client.attachTransport(r),t.client.on("tracks",t._onTracks),t.client.on("tstracks",t._onTsTracks),t.client.on("sample",t._onSample),t.client.on("clear",t._onClear),t.client.on("disconnect",t._onDisconnect),t.client.on("error",t._onError),t}return b(y,[{key:"load",value:function(){j.log("load starting!"),this.client.reset(),this.client.setSource(this.rtspurl),this.buffering=!0,this.client.start()}},{key:"seek",value:function(e){return this.client.seek(e)}},{key:"abort",value:function(){var e=this;this.client.stop().then(function(){if(e.client.transport)return e.client.transport.disconnect();throw Error("abort stream, but transport is null!")})}},{key:"pause",value:function(){return this.client.pause()}},{key:"stop",value:function(){return this.client.stop()}},{key:"destroy",value:function(){j.debug("destroy"),this.client.reset(),this.client.destroy(),this.sampleQueues={},this.tracks=null,this.remux&&this.remux.destroy()}},{key:"onTracks",value:function(e){if(j.debug("onTracks:",e),this.tracks=e,e[0].type===a.PayloadType.TS||e[0].type===a.PayloadType.PS)this.isContainer=!0;else{this.isContainer=!1;var t,r=d(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;this.sampleQueues[a.PayloadType.string_map[n.rtpmap[n.fmt[0]].name]]=[]}}catch(s){r.e(s)}finally{r.f()}this._onTracksReady(e)}}},{key:"onTsTracks",value:function(e){j.debug("onTsTracks:",e);var t,r=d(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;a.duration=this.tracks[0].duration,a.track=this.tracks[0].track,a.offset=this.tracks[0].offset,this.sampleQueues[a.type]=[]}}catch(o){r.e(o)}finally{r.f()}this.tracks[0].tracks=e;var n,s=!1,i=d(e);try{for(i.s();!(n=i.n()).done;){if(n.value.hasCodecConf){s=!0;break}}}catch(o){i.e(o)}finally{i.f()}s||this._onTracksReady(e)}},{key:"_onTracksReady",value:function(e){this.seekable=this.client.seekable,this.duration=this.client.duration,this._decideMSE(e),this.useMSE?(this.eventSource.dispatchEvent("tracks",e),this.startStreamFlush()):(this.eventSource.dispatchEvent("error",new t.ASMediaError(t.ASMediaError.MEDIA_ERR_SRC_NOT_SUPPORTED,"Codec not supported using MSE!")),this.destroy())}},{key:"onError",value:function(e){j.error(e),this.buffering=!1,this.eventSource.dispatchEvent("error",e),this.destroy()}},{key:"onSample",value:function(e){if(e.ctype!==a.PayloadType.H264&&e.ctype!==a.PayloadType.H265||!this.firstRAP&&e.isKeyFrame()&&(this.firstRAP=!0),this.firstRAP){var r=null;if(this.tracks[0].type===a.PayloadType.TS||this.tracks[0].type===a.PayloadType.PS){var n,s=d(this.tracks[0].tracks);try{for(s.s();!(n=s.n()).done;){var i=n.value;if(i.type===e.ctype){r=i;break}}}catch(E){s.e(E)}finally{s.f()}}else{var o,f=d(this.tracks);try{for(f.s();!(o=f.n()).done;){var y=o.value;if(y.type===e.ctype){r=y;break}}}catch(E){f.e(E)}finally{f.f()}}if(r){if(r.type!==a.PayloadType.H264||r.params.sps&&r.params.pps)if(r.type!==a.PayloadType.H265||r.params.vps&&r.params.sps&&r.params.pps)r.type!==a.PayloadType.AAC||r.params.config||(e.config?(r.params.config=e.config,r.codec=e.config.codec,r.ready=!0):(this.eventSource.dispatchEvent("error",new t.ASMediaError(t.ASMediaError.MEDIA_ERR_AV,"Receive AAC accessunit, but have not config information!")),this.destory()));else{var h,v=d(e.units);try{for(v.s();!(h=v.n()).done;){var m=h.value;m.type()===p.HEVC_NALU.VPS?r.params.vps=m.getData().subarray(4):m.type()===p.HEVC_NALU.SPS?r.params.sps=m.getData().subarray(4):m.type()===p.HEVC_NALU.PPS&&(r.params.pps=m.getData().subarray(4))}}catch(E){v.e(E)}finally{v.f()}r.params.vps&&r.params.sps&&r.params.pps&&(r.ready=!0,r.codec=u.H265Parser.getCodec(r.params.vps))}else{var k,b=d(e.units);try{for(b.s();!(k=b.n()).done;){var S=k.value;S.type()===l.NALU.SPS?r.params.sps=S.getData().subarray(4):S.type()===l.NALU.PPS&&(r.params.pps=S.getData().subarray(4))}}catch(E){b.e(E)}finally{b.f()}r.params.sps&&r.params.pps&&(r.ready=!0,r.codec=c.H264Parser.getCodec(r.params.sps))}if(this.isContainer){var P,g=!0,T=this.tracks[0].tracks,_=d(T);try{for(_.s();!(P=_.n()).done;){if(!P.value.ready){g=!1;break}}}catch(E){_.e(E)}finally{_.f()}g&&!this.tracksReady&&(this._onTracksReady(T),this.tracksReady=!0)}this.sampleQueues[e.ctype].push(e)}else j.warn("Receive accessunit, but not found track!")}else j.warn("Receive accessunit, but not found track, discard this access unit!")}},{key:"reset",value:function(){this.duration=NaN,this.buffering=!1,this.sampleQueues={},this.tracks=null,this.tracksReady=!1,this.firstRAP=!1,this.useMSE=!1,this.isContainer=!1}},{key:"onClear",value:function(){this.reset(),this.eventSource.dispatchEvent("clear"),j.log("onClear!")}},{key:"onDisconnect",value:function(){this.reset(),this.remux&&this.remux.destroy(),this.eventSource.dispatchEvent("error",new t.ASMediaError(t.ASMediaError.MEDIA_ERR_NETWORK,"websocket disconected!"))}},{key:"_getTimeScale",value:function(e){for(var t=0,r=0;r<this.tracks.length;r++){if(this.tracks[r].ptype===a.PayloadType.PS||this.tracks[r].ptype===a.PayloadType.TS){t=9e4;break}if(this.tracks[r].ptype===e)for(var n=this.tracks[r].rtpmap.entries(),s=0;s<n.length;s++){t=n[s][1].clock;break}}return t}},{key:"_decideMSE",value:function(e){var t=[];j.debug("MSE tracks:",e);var r,a=d(e);try{for(a.s();!(r=a.n()).done;){var i=r.value;j.debug("track type:".concat(i.type,",codec:").concat(i.codec)),t.push(i.codec)}}catch(o){a.e(o)}finally{a.f()}s.MSE.isSupported(t)?(this.useMSE=!0,this.remux=new n.Remuxer(this.video),this.remux.MSE.bufferDuration=this.bufferedDuration,this.remux.attachClient(this)):j.error('MSE not supported codec:video/mp4; codecs="'.concat(t.join(","),'"'))}},{key:"_getAudioInfo",value:function(){var e=null;if(!(e=this.isContainer?this.tracks[0].tracks:this.tracks))return null;var t,r=d(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(this.isContainer){if(n.type===a.PayloadType.AAC)return{codec:n.params.config.codec,samplerate:n.params.config.samplerate,channel:n.params.config.channel}}else if("audio"===n.type&&n.ptype===a.PayloadType.AAC)return{codec:n.params.config.codec,samplerate:n.params.config.samplerate,channel:n.params.config.channel}}}catch(s){r.e(s)}finally{r.f()}return null}},{key:"_getVideoExt",value:function(e){if(e.type===a.PayloadType.H264)return e.params.sps&&e.params.pps?c.H264Parser.readSPS(e.params.sps):null;if(e.type===a.PayloadType.H265){var t=u.H265Parser.readVPS(e.params.vps),r=u.H265Parser.readSPS(e.params.sps);return r.fixedFrameRate=t.fixedFrameRate,r.frameDuration=t.frameDuration,r}return null}},{key:"_getVideoInfo",value:function(){var e=null;if(!(e=this.isContainer?this.tracks[0].tracks:this.tracks))return null;var t,r=d(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(this.isContainer){if(n.type===a.PayloadType.H264||n.type===a.PayloadType.H265||n.type===a.PayloadType.AV1)return n.params.info||(n.params.info=this._getVideoExt(n),n.params.info.codec=n.codec),n.params.info}else if("video"===n.type&&(n.ptype===a.PayloadType.H264||n.ptype===a.PayloadType.H265||n.ptype===a.PayloadType.AV1))return n.params.info||(n.params.info=this._getVideoExt(n),n.params.info.codec=n.codec),n.params.info}}catch(s){r.e(s)}finally{r.f()}return null}},{key:"_getHasAudio",value:function(){var e,t=!1,r=d(this.isContainer?this.tracks[0].tracks:this.tracks);try{for(r.s();!(e=r.n()).done;){var n=e.value;if(this.isContainer){if(n.type===a.PayloadType.AAC){t=!0;break}}else if("audio"===n.type){t=!0;break}}}catch(s){r.e(s)}finally{r.f()}return t}},{key:"_getHasVideo",value:function(){var e,t=!1,r=d(this.isContainer?this.tracks[0].tracks:this.tracks);try{for(r.s();!(e=r.n()).done;){var n=e.value;if(this.isContainer){if(n.type===a.PayloadType.H264||n.type===a.PayloadType.H265||n.type===a.PayloadType.AV1){t=!0;break}}else if("video"===n.type){t=!0;break}}}catch(s){r.e(s)}finally{r.f()}return t}},{key:"_getHasBFrames",value:function(){var e,t=!1,r=d(this.isContainer?this.tracks[0].tracks:this.tracks);try{for(r.s();!(e=r.n()).done;){var a=e.value;if("video"===a.type){t=a.hasBFrames;break}}}catch(n){r.e(n)}finally{r.f()}return t}}]),y}();
},{"../utils/logger.js":"xVgw","../utils/ASMediaError.js":"yB1D","../BaseStream.js":"jeF6","../StreamDefine.js":"XyKO","../remuxer/remuxer.js":"y5rR","../presentation/mse.js":"hb8a","./RTSPClient":"THfu","../websocket":"fNQe","../parsers/h264.js":"DOUY","../parsers/h265.js":"izR4","../parsers/nalu.js":"lqH2","../parsers/nalu-hevc.js":"fVMu"}],"WfxK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ASPlayer=void 0;var e=t(require("./rtsp/RTSPStream"));function t(e){return e&&e.__esModule?e:{default:e}}function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,s(i.key),i)}}function o(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e){var t=u(e,"string");return"symbol"===r(t)?t:String(t)}function u(e,t){if("object"!==r(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!==r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var a=exports.ASPlayer=function(){function t(r){i(this,t),this.errorHandler=null,this.infoHandler=null,this.dataHandler=null,this.queryCredentials=null,this.bufferDuration_=120,this.supposedCurrentTime=0,this.stream=new e.default(r),this._attachVideo(r.video),this.stream.eventSource.addEventListener("error",this._onError.bind(this))}return o(t,[{key:"_attachVideo",value:function(e){var t=this;this._video=e,this._video.addEventListener("play",function(){t.isPlaying()||t.stream.start()},!1),this._video.addEventListener("pause",function(){t.stream.pause()},!1),this._video.addEventListener("seeking",function(){if(t.stream.seekable)t._is_in_buffered(t._video.currentTime)||(console.log("seek to ".concat(t._video.currentTime)),t.stream.seek(t._video.currentTime));else{var e=t._video.currentTime-t.supposedCurrentTime;Math.abs(e)>=.01&&(console.log("Seeking is disabled"),t._video.currentTime=t.supposedCurrentTime)}},!1),this._video.addEventListener("timeupdate",function(){t._video.seeking||(t.supposedCurrentTime=t._video.currentTime)},!1),this._video.addEventListener("abort",function(){t.stream.abort().then(function(){t.stream.destroy()})},!1),this._video.addEventListener("ended",function(){t.supposedCurrentTime=0},!1)}},{key:"isPlaying",value:function(){return!(this._video.paused||this.stream.paused)}},{key:"start",value:function(){if(this.stream)return this.stream.load();Promise.reject("Not attach stream!")}},{key:"stop",value:function(){this.stream.stop()}},{key:"destroy",value:function(){this.stream.destory()}},{key:"_onError",value:function(e){this.errorHandler&&this.errorHandler(e)}},{key:"_is_in_buffered",value:function(e){for(var t=this._video.buffered,r=!1,i=0;i<t.length;i++)if(e>=t.start(i)&&e<=t.end(i)){r=!0;break}return r}}]),t}();
},{"./rtsp/RTSPStream":"Kb8d"}],"H99C":[function(require,module,exports) {
"use strict";require("./styles.css");var e=require("./ASPlayer");document.getElementById("app").innerHTML='\n<h1>rtsp player</h1>\n<div class="video__container">\n<video id="test_video" controls autoplay>\n    \x3c!--<source src="rtsp://192.168.10.205:554/ch01.264" type="application/x-rtsp">--\x3e\n    \x3c!--<source src="rtsp://wowzaec2demo.streamlock.net/vod/mp4:BigBuckBunny_115k.mov" type="application/x-rtsp">--\x3e\n</video>\n</div>\n';var r=document.getElementById("test_video"),t=new e.ASPlayer({wsurl:"wss://192.168.3.100/ws_live",rtspurl:"rtsp://50011200121328555763:991100@192.168.3.100:5554/live/50011200121328555763",cacheSize:1e3,video:r,bufferedDuration:15,reconnect:!0});t.errorHandler=function(e){console.log(e)},t.start();
},{"./styles.css":"D9Nj","./ASPlayer":"WfxK"}]},{},["H99C"], null)
//# sourceMappingURL=/src.35a64567.js.map